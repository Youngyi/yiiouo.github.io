<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="who&apos;s your daddy?">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="who&apos;s your daddy?">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog">
<meta name="twitter:description" content="who&apos;s your daddy?">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-102257497-2', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f11380fcb075224d78c5110a02679bd1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/06/technology/nodemailer的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/06/technology/nodemailer的使用/" itemprop="url">nodemailer的使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-06T15:21:08+08:00">
                2017-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/06/technology/nodemailer的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/06/technology/nodemailer的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/09/06/technology/nodemailer的使用/" class="leancloud_visitors" data-flag-title="nodemailer的使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>前段时间有个很普通的项目需要发邮件的功能，而且是刚开始学nodejs，所以只是搜索了下用什么好的库能实现，就找到了nodemailer了。这篇文章主要是记录一下使用的过程和经验。</p>
</blockquote>
<h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><p>这里就先上配置</p>
<p>nodejs: v6.9.4</p>
<p>npm: 3.10.10</p>
<p>nodemailer: ^4.1.0</p>
<pre><code>const params = {
  host: &apos;smtp.163.com&apos;, // 设置服务
  port: 465, // 端口
  sercure: true, // 是否使用TLS，true，端口为465，否则其他或者568
  auth: {
    user: config.user, // 邮箱和密码
    pass: config.emailPwd
  }
}

// 邮件信息
const mailOptions = {
  from: config.user, // 发送邮箱
  to: config.emailTo, // 接受邮箱
  subject: config.title, // 标题
  html: config.html // 内容
}

// 发送邮件
const transporter = nodemailer.createTransport(params)
transporter.sendMail(mailOptions, (error, info) =&gt; {
  if (error) {
    return console.log(error);
  }
  console.log(&apos;Message %s sent: %s&apos;, info.messageId, info.response);
  // success
  // ...
})
</code></pre><p>按照这个格式，发送成功是没什么问题的。不过在<strong>密码</strong>这里要注意，不是邮箱的登录密码。</p>
<h2 id="163和qq获取授权码"><a href="#163和qq获取授权码" class="headerlink" title="163和qq获取授权码"></a>163和qq获取授权码</h2><p>163邮箱的话，要开启POP3/SMTP服务，在设置 –&gt; POP3/SMTP/IMAP页面，设置。开通后会有个授权码的，配置里的密码，就是用这个授权码</p>
<p>qq邮箱的话，同样也要开启这个服务，设置 –&gt; 账户 –&gt; POP3服务，点击开启，就会有个授权码，如果忘了记录，在开启服务下面有个“生成授权码”的，可以获取到的。</p>
<p>这样qq和163就能开启了</p>
<h2 id="Gmail"><a href="#Gmail" class="headerlink" title="Gmail"></a>Gmail</h2><p>如果是Gmail的话，这个就有点麻烦了，在nodemailer官网也有说到：</p>
<p>Gmail either works well or it does not work at all. It is probably easier to switch to an alternative service instead of fixing issues with Gmail. If Gmail does not work for you then don’t use it.</p>
<p>我这里用自己的谷歌邮箱试了下，在上面的配置修改一下</p>
<pre><code>const params = {
  service: &apos;Gmail&apos;, // 注意，host修改为service
  port: 465, // 端口
  sercure: true, // 是否使用TLS，true，端口为465，否则其他或者568
  auth: {
    user: config.user, // 邮箱和密码
    pass: config.emailPwd
  }
}
</code></pre><p>如果这样不行的话，<a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="external">打开这个链接，开启谷歌允许不够安全应用</a></p>
<p>如果还不行的话，就要配置谷歌的XOAuth2了</p>
<h3 id="配置XOAuth2"><a href="#配置XOAuth2" class="headerlink" title="配置XOAuth2"></a>配置XOAuth2</h3><p>就算使用了这种方法，也未必可能成功</p>
<p><a href="http://masashi-k.blogspot.hk/2013/06/sending-mail-with-gmail-using-xoauth2.html" target="_blank" rel="external">这是我在网上找到的配置XOAuth2的教程</a></p>
<p><a href="https://console.developers.google.com/apis/credentials" target="_blank" rel="external">在这里创建一个凭据</a>，选择OAuth客户端ID，应用类型选择“网页应用”，然后填写名称，重定向URI要记得填写，我填写的是这个”<a href="https://developers.google.com/oauthplayground" target="_blank" rel="external">https://developers.google.com/oauthplayground</a>“</p>
<p><img src="./images/nodemailer1.jpg" alt=""></p>
<p>然后记录下id和密钥</p>
<p><a href="https://developers.google.com/oauthplayground/" target="_blank" rel="external">进入此页面，进行配置</a></p>
<p><img src="./images/nodemailer2.jpg" alt=""></p>
<p>填写之前的id和密钥</p>
<p>然后就是step1，选择api</p>
<p><img src="./images/nodemailer3.jpg" alt=""></p>
<p>到step2，点击’Exchange authorization code for tokens’按钮，生成token，这样就完成了。</p>
<p>回到nodejs，重写下配置</p>
<pre><code>const params = {
  service: &apos;Gmail&apos;,
  auth: {
    type: &apos;OAuth2&apos;,
    user: config.user,
    clientId: config.clientId,
    clientSecret: config.clientSecret,
    refreshToken: config.refreshToken,
    accessToken: config.accessToken
  }
}
</code></pre><p><a href="https://nodemailer.com/smtp/oauth2/" target="_blank" rel="external">这里是官方的OAuth2配置</a></p>
<h1 id="nodemailer其他功能"><a href="#nodemailer其他功能" class="headerlink" title="nodemailer其他功能"></a>nodemailer其他功能</h1><p>这里列出我自己用过的功能，<code>nodemailer</code>看官方介绍，貌似是很多功能的</p>
<h2 id="发送多个用户："><a href="#发送多个用户：" class="headerlink" title="发送多个用户："></a>发送多个用户：</h2><pre><code>// 在配置发送信息的时候
const mailOptions = {
  from: config.user, // 发送邮箱
  to: config.emailTo + &apos;, &apos; + config.emailTo2, // 用&apos;, &apos;分隔
  subject: config.title, // 标题
  html: config.html // 内容
}
</code></pre><h2 id="发送html内容"><a href="#发送html内容" class="headerlink" title="发送html内容"></a>发送html内容</h2><pre><code>const mailOptions = {
  ....
  html: config.html // 这里可以是html字符串
}
</code></pre><h2 id="发送附件"><a href="#发送附件" class="headerlink" title="发送附件"></a>发送附件</h2><p>可以同时发送多个</p>
<p>   const mailOptions = {<br>     …<br>     attachments: [{<br>      filename: ‘test.txt’,<br>      content: ‘hello world!’<br>    },{<br>      filename: ‘test.txt’,<br>      content: ‘hello world!’,<br>      contentType: ‘text/plain’<br>    }]<br>   }</p>
<p>官方给出的配置</p>
<ul>
<li>filename - filename to be reported as the name of the attached file. Use of unicode is allowed.</li>
<li>content - String, Buffer or a Stream contents for the attachment</li>
<li>path - path to the file if you want to stream the file instead of including it (better for larger attachments)</li>
<li>href – an URL to the file (data uris are allowed as well)</li>
<li>contentType - optional content type for the attachment, if not set will be derived from the filename property</li>
<li>contentDisposition - optional content disposition type for the attachment, defaults to ‘attachment’</li>
<li>cid - optional content id for using inline images in HTML message source</li>
<li>encoding - If set and content is string, then encodes the content to a Buffer using the specified encoding. Example values: ‘base64’, ‘hex’, ‘binary’ etc. Useful if you want to use binary attachments in a JSON formatted email object.</li>
<li>headers - custom headers for the attachment node. Same usage as with message headers</li>
<li>raw - is an optional special value that overrides entire contents of current mime node including mime headers. Useful if you want to prepare node contents yourself</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>刚使用<code>nodemailer</code>踩了不少坑，弄了我一天，<code>Gmail</code>不怎么稳定，后面主管就叫换成<code>qq</code>了，据说<code>qq</code>企业邮箱发送邮件的次数比较多。这篇文章就是记录下使用<code>nodemailer</code>的一些经验。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/03/recording/你不知道的JavasScript笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/03/recording/你不知道的JavasScript笔记/" itemprop="url">你不知道的JavasScript笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-03T21:59:38+08:00">
                2017-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/03/recording/你不知道的JavasScript笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/03/recording/你不知道的JavasScript笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/09/03/recording/你不知道的JavasScript笔记/" class="leancloud_visitors" data-flag-title="你不知道的JavasScript笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>记录读这本书的时候，一些笔记，方便以后再看</p>
</blockquote>
<h1 id="1-1作用域是什么"><a href="#1-1作用域是什么" class="headerlink" title="1.1作用域是什么"></a>1.1作用域是什么</h1><p>传统编译语言，代码在执行前，会经历三个步骤：</p>
<ol>
<li><p>分词/词法分析</p>
<p>词法分析，会把一段代码分成一个个模块：<code>var a = 1</code>，会被分成<code>var  a  =  1</code></p>
</li>
<li><p>解析/语法分析</p>
<p>将词法单元流（数组）转换成一个由元素组成的树（AST），抽象语法树</p>
<pre><code>|-- Identifier (a)
</code></pre><p> VariableDeclaration -|</p>
<pre><code>|-- AssignmentExpression -|-- 2
</code></pre></li>
<li><p>代码生成</p>
<p>根据语言将AST转换可执行代码</p>
</li>
</ol>
<p>一段代码的执行，需要三个“帮手”，</p>
<ul>
<li><p>引擎</p>
<p>负责整个程序的编译和执行</p>
</li>
<li><p>编译器</p>
<p>负责语法分析和代码生成</p>
</li>
<li><p>作用域</p>
<p>收集和维护所有声明的标识符，按照规定的规则，对标识符是否有访问的权限</p>
</li>
</ul>
<p>变量的赋值操作会执行两个动作，编译器先在当前作用域声明变量，然后再运行时引擎会在作用域查找该变量，如果找到就赋值</p>
<p>编译器在生成代码时，会有两个查询：LHS , RHS</p>
<ul>
<li><p>LHS</p>
<p>LHS查询，会对当前变量在当前作用域查找它本身，找到后就会进行赋值，找不到会从当前作用域往上找，知道找到为止，如果没有，就会生成一个新的变量，并进行赋值。如果操作是非法（对undefiend, null进行赋值，就会报<code>Typeerror</code>错误）</p>
</li>
<li><p>RHS</p>
<p>RHS查询，对目标进行查找并且获取值，先在当前作用域寻找</p>
<p><code>console.log(a)</code>通过RHS查询，获取<code>a</code>的值。如果在所有的作用域都找不到<code>a</code>的话，就会报<code>ReferenceError</code>错误</p>
</li>
</ul>
<p>作用域的查找，会在当前作用域查询，找不到就会一步一步往上找，直到全局作用域。</p>
<h1 id="1-2词法作用域"><a href="#1-2词法作用域" class="headerlink" title="1.2词法作用域"></a>1.2词法作用域</h1><p>看不懂。。。。不要使用<code>eval</code>和<code>with</code></p>
<h1 id="1-3函数作用域和块作用域"><a href="#1-3函数作用域和块作用域" class="headerlink" title="1.3函数作用域和块作用域"></a>1.3函数作用域和块作用域</h1><p><code>function</code>是声明的一个词，就是一个函数声明，否则就是函数表达式</p>
<p>IIFE，立即执行函数表达式</p>
<p>UMD，将运行的函数放在第二位，通过参数导入运行</p>
<p>块作用域</p>
<p><code>let</code>不会再块作用域，声明提升</p>
<pre><code>var a = 1
console.log(a)
obj.addEventListener(&apos;click&apos;, function(e) {
  // ...
}, false)
</code></pre><p>上面代码，打印<code>a</code>后，就没有再引用到<code>a</code>，理论上应该是被回收了。然而<code>click</code>点击事件函数，覆盖了整个作用域的闭包，引擎很有可能会保存这个结构 （这是书中所说的，待考证）</p>
<pre><code>{
  let a = 1
  console.log(a)
}
</code></pre><p>通过块结构，让引擎回收<code>a</code></p>
<h1 id="1-4提升"><a href="#1-4提升" class="headerlink" title="1.4提升"></a>1.4提升</h1><p>先声明，后赋值。使用<code>var</code>和函数声明，都会把变量提升</p>
<p>避免重复声明同一个变量函数</p>
<pre><code>foo() // 1

var foo

function foo() {
  console.log(1)
}

foo = function() {
  console.log(2)
}

------

// 首先foo(1)，然后foo(3)覆盖了foo(1)
foo() //3

function foo() {
  console.log(1)
}

var foo = function() {
  console.log(2)
}

function foo() {
  console.log(3)
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/02/technology/多页面配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/02/technology/多页面配置/" itemprop="url">多页面配置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-02T17:30:20+08:00">
                2017-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/02/technology/多页面配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/02/technology/多页面配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/09/02/technology/多页面配置/" class="leancloud_visitors" data-flag-title="多页面配置">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>这个主要是说明express + gulp的配置，重点在gulp，因为nodejs我也不怎么会</p>
</blockquote>
<h2 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h2><p>nodejs: 后端</p>
<p>express: nodejs框架</p>
<p>pug(jade): nodejs模板</p>
<p>mongodb: 数据库</p>
<p>lowdb: 数据库</p>
<p>gulp：编译工具</p>
<p>browser-sync: 自动刷新页面</p>
<p>browserify: 转换es6代码</p>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p><code>clone</code>项目</p>
<p><code>npm i</code>  安装依赖</p>
<p><code>gulp build</code>  生成静态文件</p>
<p><code>gulp watch</code>  进行开发</p>
<hr>
<h2 id="gulp"><a href="#gulp" class="headerlink" title="gulp"></a>gulp</h2><p><a href="http://www.gulpjs.com.cn/" target="_blank" rel="external">gulp中文文档</a></p>
<h3 id="gulp语法"><a href="#gulp语法" class="headerlink" title="gulp语法"></a>gulp语法</h3><p><code>gulp</code>是基于<strong>流</strong>进行操作的</p>
<p>而“流”，是数据的集合可以通过<code>pipe</code>方法，对上一个处理好的数据传递到下一个要处理的位置上</p>
<pre><code>gulp.src(&apos;main.js&apos;).pipe(uglify())
</code></pre><p>上面这一行代码，<code>gulp</code>通过<code>src</code>的方法获取<code>main.js</code>的流数据，通过<code>pipe</code>方法，把数据传递给<code>uglify</code>方法并执行</p>
<p><a href="http://nodejs.cn/api/stream.html" target="_blank" rel="external">nodejs官方文档</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/24432941" target="_blank" rel="external">Node.js流的解析</a></p>
<p><code>gulp</code>的方法，官方文档就给出了4个：src, task, dest, watch</p>
<h4 id="gulp-src-globs-options"><a href="#gulp-src-globs-options" class="headerlink" title="gulp.src(globs[, options])"></a>gulp.src(globs[, options])</h4><p>可以接受两个参数，第一个参数必选，可以是字符串或者数组。第一个参数用来匹配相应的文件</p>
<pre><code>// 这里会匹配&quot;src/js&quot;下面的所有.js文件
gulp.src(&apos;./src/js/*.js&apos;)

// 这里会匹配&quot;src/js&quot; 和 &quot;src/test&quot;下面的所有.js文件
gulp.src([&apos;./src/js/*.js&apos;, &apos;.s/src/test/*.js&apos;])
</code></pre><p><a href="https://github.com/isaacs/node-glob" target="_blank" rel="external">这里有很多匹配的规则</a></p>
<p>第二个参数是<code>options</code>，选择配置等，详细看<code>gulp</code>文档</p>
<h4 id="gulp-task-name-deps-fn"><a href="#gulp-task-name-deps-fn" class="headerlink" title="gulp.task(name[, deps], fn)"></a>gulp.task(name[, deps], fn)</h4><p>可以接受三个参数，第一个参数是字符串，声明这个任务的名字</p>
<p>第二个参数是数组，可选，在这个<code>fn</code>前，要执行的任务</p>
<p>第三个参数回调函数，必选，定义这个任务要干嘛</p>
<pre><code>gulp.task(&apos;say&apos;, function() {
  // ...
  console.log(&apos;say&apos;)
})
// 在执行&apos;hello&apos;任务之前，会先执行&apos;say&apos;任务
gulp.task(&apos;hello&apos;, [&apos;say&apos;], function(){
  // ...
  console.log(&apos;hello&apos;)
})
// 执行任务
gulp hello
// 终端就会打印出两行
...
say
...
hello
</code></pre><p><img src="./images/gulp1.jpg" alt=""></p>
<p><code>gulp.task</code>就是定义一个任务</p>
<h4 id="gulp-dest-path-options"><a href="#gulp-dest-path-options" class="headerlink" title="gulp.dest(path[, options])"></a>gulp.dest(path[, options])</h4><p>可以接受两个参数，第一个参数<code>path</code>，输出的路径</p>
<p>第二个参数配置选项，详情看<code>gulp</code>文档</p>
<p><code>gulp.dest</code>会把流数据，生成一个新的文件，如果指定的路径文件夹不存在，就会自动创建</p>
<pre><code>// 比如我将es6的代码转为es5后，最终输出到&apos;/dist/&apos;目录下
gulp.src(&apos;index.js&apos;)
    .pipe(babel())
    .......
    .pipe(gulp.dest(&apos;./dist/&apos;))
</code></pre><p><code>gulp.dest</code>就是指定文件输出到哪里</p>
<h4 id="gulp-watch"><a href="#gulp-watch" class="headerlink" title="gulp.watch()"></a>gulp.watch()</h4><p><code>gulp.watch</code>就是监听文件，当文件发生变化后，执行你定义好的操作</p>
<pre><code>// 监听&apos;js&apos;文件夹下面的所有.js文件 和 &apos;js&apos;文件夹中的子级文件夹的下面所有的.js文件，当这些文件变化后，执行定义好的&apos;js&apos;任务
gulp.watch([&apos;./js/*.js&apos;, &apos;./js/*/*.js&apos;], [&apos;js&apos;])

// 执行回调函数
gulp.watch([&apos;*.js&apos;], function(e) {
  console.log(e)
})
</code></pre><p><code>gulp.watch</code>还有其他一些参数配置，详情看<code>gulp</code>官方文档</p>
<h3 id="gulp插件"><a href="#gulp插件" class="headerlink" title="gulp插件"></a>gulp插件</h3><h4 id="js"><a href="#js" class="headerlink" title="js"></a>js</h4><ul>
<li><p>babelify</p>
<p>解析es6代码</p>
</li>
<li><p>browerify</p>
<p>解析<code>module</code>语法为AMD或CMD</p>
</li>
<li><p>vinyl-source-stream, vinyl-buffer</p>
<p>将常规流转换为包含Stream的vinyl对象，再转为Buffer，大概的作用是配合browerify一起使用  </p>
</li>
<li><p>gulp-uglify</p>
<p>压缩js文件</p>
</li>
</ul>
<h4 id="css"><a href="#css" class="headerlink" title="css"></a>css</h4><ul>
<li><p>gulp-sass/gulp-less</p>
<p>解析scss/less文件</p>
</li>
<li><p>gulp-clean-css</p>
<p><a href="https://github.com/jakubpawlowicz/clean-css#how-to-use-clean-css-api" target="_blank" rel="external">https://github.com/jakubpawlowicz/clean-css#how-to-use-clean-css-api</a></p>
<p>打包处理css文件</p>
</li>
<li><p>gulp-autoprefixer</p>
<p>自动添加css前缀</p>
</li>
</ul>
<h4 id="image"><a href="#image" class="headerlink" title="image"></a>image</h4><ul>
<li><p>gulp-imagemin</p>
<p>压缩图片</p>
</li>
</ul>
<h4 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h4><ul>
<li><p>gulp-sourcemaps</p>
<p><code>es6</code>的代码，转译成可执行的代码后，是非常难看的，这样不利于我们<code>debug</code>，这个插件可以告诉你错误的代码在哪一行</p>
</li>
<li><p>gulp-plumber</p>
<p>如果js或css发生了语法错误的话，<code>gulp</code>会停止运行的，使用了<code>gulp-plumber</code>之后，错误会显示在终端，而且大部分的错误不会使<code>gulp</code>停止运行。这个插件可以用于<code>js</code>, <code>css</code>, <code>es-lint</code>都可以。</p>
</li>
<li><p>gulp-notify</p>
<p>在终端打印信息</p>
</li>
<li><p>browser-sync</p>
<p>自动刷新工具，监测文件变化，从而自动刷新，<code>css</code>更新的话，会直接插入新的<code>css</code>，不会直接更新。而且可以带起代理，服务</p>
</li>
</ul>
<h3 id="这份配置文件，实现了什么功能"><a href="#这份配置文件，实现了什么功能" class="headerlink" title="这份配置文件，实现了什么功能"></a>这份配置文件，实现了什么功能</h3><ol>
<li><p>可以使用es7, es6的语法，自动压缩、合并js文件</p>
</li>
<li><p>可以使用less和sass，添加前缀，压缩css文件</p>
</li>
<li><p>文件变化，自动刷新页面</p>
</li>
<li><p>es-lint</p>
</li>
<li><p>压缩图片大小</p>
</li>
</ol>
<p>前端的配置，这里是使用<code>gulp</code>完成一系列的任务，<code>gulp</code>的使用，可以自定义的进行操作，最终我们只需要关注打包之后的文件就可以了</p>
<p>后续再看看如何增加版本号、hash值这些</p>
<h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h3><p>使用<code>pug(jade)</code>模板，进行服务端渲染。</p>
<p>默认配置了lowdb和mongodb，使用哪一个，在<code>app.js</code>调用就好</p>
<h4 id="database"><a href="#database" class="headerlink" title="database"></a>database</h4><p>lowdb是基于操作<code>.json</code>文件的，所有的数据存储在一个<code>.json</code>文件上，简单易上手，无脑配置，如果数据量大，性能会不好</p>
<p>mongodb是一种NoSQL(Not only SQL)，不是关系型数据库，以<code>json</code>的格式存储数据，但不是操作<code>.json</code>文件，数据文件是二进制的。相对lowdb会复杂点，但还是容易上手</p>
<h4 id="关系型数据库和非关系型数据库的区别"><a href="#关系型数据库和非关系型数据库的区别" class="headerlink" title="关系型数据库和非关系型数据库的区别"></a>关系型数据库和非关系型数据库的区别</h4><p>RDBMS </p>
<ul>
<li><p>高度组织化结构化数据 </p>
</li>
<li><p>结构化查询语言（SQL） (SQL) </p>
</li>
<li><p>数据和关系都存储在单独的表中。 </p>
</li>
<li><p>数据操纵语言，数据定义语言 </p>
</li>
<li><p>严格的一致性</p>
</li>
<li><p>基础事务</p>
</li>
</ul>
<p>NoSQL </p>
<ul>
<li><p>代表着不仅仅是SQL</p>
</li>
<li><p>没有声明性查询语言</p>
</li>
<li><p>没有预定义的模式</p>
</li>
</ul>
<p>-键 - 值对存储，列存储，文档存储，图形数据库</p>
<ul>
<li><p>最终一致性，而非ACID属性</p>
</li>
<li><p>非结构化和不可预知的数据</p>
</li>
<li><p>CAP定理 </p>
</li>
<li><p>高性能，高可用性和可伸缩性</p>
</li>
</ul>
<h4 id="mongoose"><a href="#mongoose" class="headerlink" title="mongoose"></a>mongoose</h4><p>mongoose是基于mongodb封装好的一个对象模型库，封装了一些方法，使我们更加规范的去操作数据库</p>
<h2 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h2><pre><code>+---lib                      ----    数据库文件        
|   +---lowdb                ----                                      
|   |                        ----          
|   \---mongodb              ----                                      
|                            ----      
+---logs                     ----    日志文件
|                            ----
+---public                   ----    前端打包后的文件   
|   +---dist                 ----                 
|   |   +---css              ----                    
|   |   \---js               ----                   
|   +---img                  ----                
|   \---lib                  ----    前端公共库            
+---routes                   ----    后端路由                   
|                            ----      
+---src                      ----    前端静态文件      
|   +---css                  ----                                        
|   |                        ----          
|   +---img                  ----                                     
|   |                        ----          
|   \---js                   ----                                   
|                            ----      
+---util                     ----    后端工具文件                                
|                            ----      
\---views                    ----    前端模板文件       
|   |   404.pug              ----                    
|   |   error.pug            ----                      
|   |   index.pug            ----                      
|   |   layout.pug           ----                       
|   |                        ----                          
|   .babelrc                 ----                 
|   .eslintrc                ----                  
|   .gitignore               ----     入口文件             
|   app.js                   ----               
|   config.example.js        ----     配置文件                         
|   gulpfile.js              ----                    
|   package.json             ----                     
|   README.md                ----                  
|
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/24/recording/git操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/24/recording/git操作/" itemprop="url">git操作</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-24T23:56:01+08:00">
                2017-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/24/recording/git操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/24/recording/git操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/24/recording/git操作/" class="leancloud_visitors" data-flag-title="git操作">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git日常操作"><a href="#git日常操作" class="headerlink" title="git日常操作"></a>git日常操作</h1><ul>
<li>删除：git rm</li>
<li>删除文件夹： git rm -r</li>
<li>回滚：git revert</li>
<li>回滚报错取消：git revert –abort</li>
</ul>
<p>git revert回滚操作，只能一级一级的回滚，不能跳级回滚</p>
<p>.gitignore</p>
<p>如果要忽悠某个原本已经在仓库的文件，要先删除它才行</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/21/recording/lowdb使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/21/recording/lowdb使用/" itemprop="url">lowdb使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-21T21:04:49+08:00">
                2017-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/21/recording/lowdb使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/21/recording/lowdb使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/21/recording/lowdb使用/" class="leancloud_visitors" data-flag-title="lowdb使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><pre><code>cnpm i lowdb --save-dev


// nodejs
const low = require(&apos;lowdb&apos;)
const FileSync = require(&apos;lowdb/adapters/FileSync&apos;)
// 进行异步模式
const adapter = new FileSync(&apos;db.json&apos;)
// 实例一个db对象
const db = low(adapter)
// 设置默认值，并写入
db.defaults({
  banner: [],
  category: [],
  product: [],
  usre: []
}).write()
</code></pre><p><code>db.get(&#39;banner[0]&#39;), db.get(&#39;user.title&#39;), db.get(&#39;banner[0].title&#39;)</code>，都是获取某个值，最后要加上<code>.value()</code></p>
<p><code>db.getState()</code>，查看db的状态</p>
<p><code>db.setState({})</code>，清空db</p>
<p><code>db.write().id</code>，自动插入随机id值</p>
<p><code>db.has(&#39;posts&#39;).value()</code>，判断是否有这个值</p>
<p><code>db.set(&#39;posts&#39;, []).write()</code>，将<code>posts</code>值设置为[]</p>
<p>使用<code>.push()</code>插入数据，在插入数据前，要先<code>get(&#39;filed&#39;)</code>，声明向谁插入，最后就写入<code>write()</code></p>
<p><code>db.get(&#39;banner&#39;).size().value()</code>，获取banner有多少条数据</p>
<p><code>db.get(&#39;posts&#39;).find({ title: &#39;low!&#39; }).assign({ title: &#39;hi!&#39;}).write()</code>，获取<code>posts</code>字段，搜索<code>title</code>为’low!’的值，替换成’hi!’，最后写入</p>
<p><code>db.get(&#39;posts&#39;).remove({ title: &#39;low!&#39; }).write()</code> ，删除</p>
<p><code>db.unset(&#39;user.name&#39;).write()</code>，删除一个字段</p>
<h1 id="发现个严重问题"><a href="#发现个严重问题" class="headerlink" title="发现个严重问题"></a>发现个严重问题</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/10/recording/mongoose的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/10/recording/mongoose的使用/" itemprop="url">mongoose的使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-10T11:14:37+08:00">
                2017-08-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/10/recording/mongoose的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/10/recording/mongoose的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/10/recording/mongoose的使用/" class="leancloud_visitors" data-flag-title="mongoose的使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>学习了mongodb后，接着就是和nodejs进行对接，怎么在nodejs上使用mongodb。我这里选择的是mongoose，至于为啥，可能教程稍微多点吧。不过，这个mongoose还是有点复杂的。。。</p>
</blockquote>
<p><a href="http://mongoosejs.com/docs/guide.html" target="_blank" rel="external">官方文档</a></p>
<p><a href="https://mongoose.shujuwajue.com/guide/schemas.html" target="_blank" rel="external">中文文档</a></p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><pre><code>// 安装包
npm i mongoose -S
</code></pre><p>我nodejs使用的框架是<code>express</code>。</p>
<pre><code>// 首先导入mongoose
var mongoose = require(&apos;mongoose&apos;)
// 实例化一个骨架
var Schema = mongoose.Schema
/*
  Schema里面的参数，{ paw: String }
  是规定，执行操作的时，约定的字段和类型
  让格式更清晰吧
  而且可以定义默认值
*/
var testSchema = new Schema({
  name: { type: String, default: &apos;Val&apos;},
  paw: String
})

/* 
  为&quot;users&quot;的model，添加自定义方法
  这个&quot;users&quot;是你要操作的集合（collection）
*/
testSchema.methods.findSimilarTypes = function(cb) {
  // .find({})这些就跟操作mongodb时一样了，cb就是回调函数
  return this.model(&apos;users&apos;).find({ name: this.name }, cb)
}
testSchema.methods.findSimilarTypes2 = function(cb) {
  return this.model(&apos;users&apos;).find({ paw: this.paw }, cb)
}

// 将骨架发布为model，同理这个&quot;users&quot;是要操作的集合
var Test = mongoose.model(&apos;users&apos;, testSchema)

// 实例一个实体(entity)，传一个{}参数
var _entity = new Test({ name: &apos;232&apos;, paw: &apos;22&apos; })

// 执行之前定义的方法，打印获取到的数据
_entity.findSimilarTypes2(function(err, data) {
  console.log(data)
})
</code></pre><p>总结下：</p>
<ol>
<li>首先定义一个骨架，约定好字段和字段的类型(String, Array, Number这些，还有很多种)</li>
<li>为这个骨架添加自定义方法，这里就是要对数据库CRUD了</li>
<li>然后根据这个骨架，发布一个model，对要操作的数据库，定义好</li>
<li>接着就实例一个实体（entity），传入之前约定好的字段</li>
<li>最后就是执行之前自定义好的方法，获取到数据</li>
</ol>
<p>还有，不一定使用自定义方法，mongoose内置很多定义的方法</p>
<p>下面我们详细说下每个东西的详细值</p>
<h2 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h2><p>Schema，就是这个操作的骨架，形式，约定好字段和字段的类型。例如在后面的操作，会出现什么字段，是什么类型的，一些操作，都在这里定义好。</p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>String</li>
<li>Number</li>
<li>Date</li>
<li>Buffer</li>
<li>Boolean</li>
<li>Mixed</li>
<li>Objectid</li>
<li><p>Array</p>
<p>  new Schema({</p>
<pre><code>name: String,
data: Array,
list: {
  type: Array,
  default: [1, 2, 3]
}
msg: {
  type: String,
  default: &apos;abc&apos;,
  lowercase: true, // 小写
  trim: true // 去空格
},
updated: { type: Date, default: Date.now },
age: { type: Number, min: 18, max: 65 },
</code></pre><p>  })</p>
</li>
</ul>
<p>可以看到，有很多内置方法，这些都能减轻工作</p>
<h2 id="model"><a href="#model" class="headerlink" title="model"></a>model</h2><h3 id="内置方法"><a href="#内置方法" class="headerlink" title="内置方法"></a>内置方法</h3><p>先定义个骨架</p>
<pre><code>var User = new Schema({
  name: String,
  pwd: String,
  avatar: String,
  createdTime: {
    type: Date,
    default: Date.now
  },
  email: String,
  token: String
})
</code></pre><p>再生成一个model</p>
<pre><code>var Test = mognoose.model(&apos;user&apos;, User)
</code></pre><p>使用内置的方法</p>
<pre><code>Test.find(function(error, data){
  console.log(data)
})
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/07/recording/微信小程序学习记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/07/recording/微信小程序学习记录/" itemprop="url">微信小程序学习记录</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-07T15:18:25+08:00">
                2017-08-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/07/recording/微信小程序学习记录/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/07/recording/微信小程序学习记录/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/07/recording/微信小程序学习记录/" class="leancloud_visitors" data-flag-title="微信小程序学习记录">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>公司要开发个小程序官网，所以就学习下微信小程序，顺带记录一下要点</p>
</blockquote>
<h1 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h1><h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><ul>
<li>app.js - 入口文件</li>
<li>app.json - 配置文件</li>
<li>app.wxss - css主体</li>
</ul>
<h3 id="app-json"><a href="#app-json" class="headerlink" title="app.json"></a>app.json</h3><p>决定页面文件的路径、窗口表现、设置网络超时时间、设置多 tab 、是否开启debug模式</p>
<h4 id="pages"><a href="#pages" class="headerlink" title="pages"></a>pages</h4><p>整个小程序的路由配置</p>
<h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>用于设置小程序的状态栏、导航条、标题、窗口背景色</p>
<h4 id="tabBar"><a href="#tabBar" class="headerlink" title="tabBar"></a>tabBar</h4><p>底部tabBar设置</p>
<h4 id="networkTimeout"><a href="#networkTimeout" class="headerlink" title="networkTimeout"></a>networkTimeout</h4><p>网络请求的设置</p>
<h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h4><p>调试信息以info输出到控制面板</p>
<p>页面配置：</p>
<p>每个页面由4个文件组成：js、wxml、wxss、json。分别对应的是逻辑、结果、样式、配置</p>
<h1 id="逻辑层"><a href="#逻辑层" class="headerlink" title="逻辑层"></a>逻辑层</h1><p><code>App()</code>用来注册小程序，接受一个object参数</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><pre><code>App({
  onLaunch: function(options) {
    // 初始化，页面还没生成
  },
  onShow: function(options) {
      // 从后台进入前台显示
  },
  onHide: function() {
      // 从前台进入后台
  },
  onError: function(msg) {
    console.log(msg)
  },
  // 可以添加任意的数据进入参数里，然后通过this调用
  globalData: &apos;I am global data&apos;
})

// 全局函数
getApp()
</code></pre><p>在<code>onLaunch()</code>和<code>onShow</code>的参数可以获取一些信息数据、场景值</p>
<h2 id="页面注册"><a href="#页面注册" class="headerlink" title="页面注册"></a>页面注册</h2><pre><code>Page({
  data: {
    // 声明属性
    text: &quot;This is page data.&quot;
  },
  // 注册页面的生命周期
  onLoad: function(options) {
    // Do some initialize when page load.
  },
  onReady: function() {
    // Do something when page ready.
  },
  onShow: function() {
    // Do something when page show.
  },
  onHide: function() {
    // Do something when page hide.
  },
  onUnload: function() {
    // Do something when page close.
  },
  onPullDownRefresh: function() {
    // Do something when pull down.
  },
  onReachBottom: function() {
    // Do something when page reach bottom.
  },
  onShareAppMessage: function () {
   // return custom share data when user share.
  },
  onPageScroll: function() {
    // Do something when page scroll
  },
  // 自定义事件
  viewTap: function() {
    this.setData({
      text: &apos;Set some data for updating view.&apos;
    })
  },
  customData: {
    hi: &apos;MINA&apos;
  }
})
</code></pre><h2 id="api"><a href="#api" class="headerlink" title="api"></a>api</h2><p>使用<code>wx.openLocation</code>进行地图导航的跳转</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/04/recording/nodejs的学习和使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/04/recording/nodejs的学习和使用/" itemprop="url">nodejs的学习和使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-04T16:52:41+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/04/recording/nodejs的学习和使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/04/recording/nodejs的学习和使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/04/recording/nodejs的学习和使用/" class="leancloud_visitors" data-flag-title="nodejs的学习和使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>记录一些nodejs学习的内容</p>
</blockquote>
<p>这篇文字，是(<a href="https://github.com/nswbmw/N-blog/)[https://github.com/nswbmw/N-blog/]这里进行学习nodejs，进行归纳的" target="_blank" rel="external">https://github.com/nswbmw/N-blog/)[https://github.com/nswbmw/N-blog/]这里进行学习nodejs，进行归纳的</a></p>
<h1 id="使用express"><a href="#使用express" class="headerlink" title="使用express"></a>使用express</h1><p>cnpm i express –save</p>
<p>新建<code>index.js</code>文件</p>
<pre><code>var express = require(&apos;express&apos;)
var app = express()

app.get(&apos;/&apos;, function(req, res) {
  res.send(&apos;hello, 11&apos;)
})

app.listen(3000)
</code></pre><p>开启服务：<code>node indexjs</code></p>
<h1 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h1><p>安装在全局下：<code>npm install -g supervisor</code></p>
<p>启动程序：<code>supervisor --harmony index</code></p>
<p>这个包的作用，当你更改后，刷新网页会更新，而不用重新开启服务才刷新</p>
<h1 id="ejs"><a href="#ejs" class="headerlink" title="ejs"></a>ejs</h1><p><code>cnpm i ejs -S</code></p>
<p>安装<code>ejs</code>，可以使用模板引擎，进行服务的渲染</p>
<pre><code>// 路由
router.get(&apos;/:name&apos;, function(req, res) {
  // 进行渲染
  res.render(&apos;users&apos;, {
    name: req.params.name
  })
})

// 模板文件（users.ejs)
&lt;h1&gt;&lt;%= name.toUpperCase() %&gt;&lt;/h1&gt;
&lt;p&gt;hello, &lt;%= name %&gt;&lt;/p&gt;

// 入口文件，启用ejs
app.set(&apos;views&apos;, path.join(__dirname, &apos;myblog/views&apos;));// 设置存放模板文件的目录
app.set(&apos;view engine&apos;, &apos;ejs&apos;);// 设置模板引擎为 ejs
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/04/recording/mongodb使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/04/recording/mongodb使用/" itemprop="url">mongodb使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-04T15:35:12+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/04/recording/mongodb使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/04/recording/mongodb使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/04/recording/mongodb使用/" class="leancloud_visitors" data-flag-title="mongodb使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>记录了mongodb安装、配置和基本的使用</p>
</blockquote>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol>
<li>在官网下载你所需要的版本（我的是windows）</li>
<li>安装（可以指定目录）</li>
<li>windows是要配置环境变量，不然会出现闪退的情况</li>
</ol>
<p>在系统变量的PATH中，添加一个新的变量，是你mongodb下载的路径（我的是：C:\Program Files\MongoDB\Server\3.4\bin）</p>
<ol>
<li>可以选择你数据库文件放在的位置（好像默认是在C盘的）</li>
</ol>
<p>在命令行，进入到mongod.exe的目录下，输入：</p>
<pre><code>mongod.exe --dbpath h:\mongodb\data\db
</code></pre><p>这样就能更改数据库数据存放的位置</p>
<h1 id="moongodb可视化工具"><a href="#moongodb可视化工具" class="headerlink" title="moongodb可视化工具"></a>moongodb可视化工具</h1><p>我这里使用的是<code>studio 3T</code></p>
<p>到官网下载即可</p>
<p><a href="https://studio3t.com/" target="_blank" rel="external">https://studio3t.com/</a></p>
<h1 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h1><h2 id="常用词"><a href="#常用词" class="headerlink" title="常用词"></a>常用词</h2><p>将比较长的词进行简写：</p>
<ul>
<li>COLLECTION_NAME:CN（集合名）</li>
</ul>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li>show dbs：显示有什么数据库存在</li>
<li>show tables：显示集合</li>
<li>db：显示当前的数据库或集合</li>
<li>use db：连接特定的数据库</li>
</ul>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>进入目标数据库后，执行：<code>db.dropDatabase()</code></p>
<h3 id="删除collection"><a href="#删除collection" class="headerlink" title="删除collection"></a>删除collection</h3><p><code>db.CN.drop()</code></p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>find(), findOne()</p>
<pre><code>db.CN.find(query, projection)
</code></pre><ul>
<li>query ：可选，使用查询操作符指定查询条件</li>
<li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值，只需省略该参数即可（默认省略）</li>
</ul>
<p>例子：</p>
<pre><code>db.CN.find()
// 添加查询条件
db.CN.find({&apos;_id&apos;: 2})
// 只显示匹配到的第一条
db.CN.findOne()
// 美化查询结果
db.CN.find().pretty()
</code></pre><h4 id="数组查询"><a href="#数组查询" class="headerlink" title="数组查询"></a>数组查询</h4><p><code>$elemMath</code> 操作符为数组元素指定复合条件，以查询数组中至少一个元素满足所有指定条件的文档</p>
<pre><code>// 查询 finished 数组至少包含 一个大于 ($gt) 15 并且小于 ($lt) 20 
db.CN.find( { finished: { $elemMatch: { $gt: 15, $lt: 20 } } } )
</code></pre><h3 id="映射字段"><a href="#映射字段" class="headerlink" title="映射字段"></a>映射字段</h3><p>指定显示或排除哪些字段</p>
<p>1或true，为显示;0或false，为隐藏</p>
<p><code>_id</code>字段，默认显示</p>
<p>不能在映射文档中组合 包含和排除 语句</p>
<pre><code>// 显示所有字段
db.CN.find( { status: &quot;A&quot; } )

// 只显示&apos;_id&apos; , status&apos; 和 &apos;name&apos;
db.CN.find( { status: &quot;A&quot; }, { name: 1, status: 1 } )

// 只显示&apos;status&apos;
db.CN.find( { status: &quot;A&quot; }, { status: 1, _id: 0 } )

// 除了&apos;favorites&apos; 和 &apos;points&apos;，其他字段都显示
db.CN.find( { status: &quot;A&quot; }, { favorites: 0, points: 0 } )

// 包含 favorites 文档中的 food 字段（排除同理）
db.CN.find(
   { status: &quot;A&quot; },
   { name: 1, &quot;favorites.food&quot;: 1 }
)
// result
{ &quot;_id&quot; : 3, &quot;name&quot; : &quot;ahn&quot;, &quot;favorites&quot; : { &quot;food&quot; : &quot;cake&quot; } }
{ &quot;_id&quot; : 6, &quot;name&quot; : &quot;abc&quot;, &quot;favorites&quot; : { &quot;food&quot; : &quot;pizza&quot; } }

// 数组，points中的bonus字段（排除同理）
db.CN.find( { status: &quot;A&quot; }, { name: 1, &quot;points.bonus&quot;: 1 } )
// result
{ &quot;_id&quot; : 2, &quot;name&quot; : &quot;bob&quot;, &quot;points&quot; : [ { &quot;bonus&quot; : 20 }, { &quot;bonus&quot; : 12 } ] }
{ &quot;_id&quot; : 3, &quot;name&quot; : &quot;ahn&quot;, &quot;points&quot; : [ { &quot;bonus&quot; : 8 }, { &quot;bonus&quot; : 20 } ] }
</code></pre><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>insert() , insertOne() , insertMany()</p>
<p>添加字段，如果没有<code>_id</code>字段的话，会自动生成</p>
<p><code>db.CN.insert(document)</code></p>
<h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><pre><code>db.CN.insert({
  title: 1,
  name: &apos;name&apos;
})
</code></pre><h4 id="insertMany"><a href="#insertMany" class="headerlink" title="insertMany"></a>insertMany</h4><pre><code>// 插入多条数据
db.CN.insertMany(
   [
     { name: &quot;bob&quot;, age: 42, status: &quot;A&quot;, },
     { name: &quot;ahn&quot;, age: 22, status: &quot;A&quot;, },
     { name: &quot;xi&quot;, age: 34, status: &quot;D&quot;, }
   ]
)
</code></pre><p><code>insert</code>方法貌似都可以代替<code>insertOne</code>和<code>insertMany</code>，根据其他文章所知，<code>insert</code>在主要驱动程序已被弃用</p>
<p>同理，update,delete,find一样    </p>
<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><p>update, updateOne, updateMany, replaceOne, save</p>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><pre><code>db.CN.update(
  &lt;query&gt;,
  &lt;update&gt;,
  {
    upsert: &lt;boolean&gt;,
    multi: &lt;boolean&gt;,
    writeConcern: &lt;document&gt;
  }
)
</code></pre><h4 id="replaceOne"><a href="#replaceOne" class="headerlink" title="replaceOne"></a>replaceOne</h4><pre><code>// 替换&apos;name&apos; === &apos;abc&apos;那个文档
db.CN.replaceOne(
  { name: &quot;abc&quot; },
  { name: &quot;amy&quot;, age: 34, type: 2, status: &quot;P&quot;, favorites: { &quot;artist&quot;: &quot;Dali&quot;, food: &quot;donuts&quot; } }
)
</code></pre><h4 id="save"><a href="#save" class="headerlink" title="save"></a>save</h4><pre><code>db.CN.save({
  _id: 1
  title: 1,
  name: &apos;name&apos;
})
</code></pre><p>如果不指定id，和Insert一样，指定id，就会替换对应的数据</p>
<p>参数：</p>
<ul>
<li>query : update的查询条件</li>
<li>update : update的对象和值</li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入</li>
<li>multi : 可选，mongodb默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新</li>
<li>writeConcern :可选，抛出异常的级别</li>
</ul>
<p>例子：</p>
<pre><code>// 将&apos;_id&apos;为2的数据，&apos;title&apos;改为&apos;hahahahaha&apos;
// $set，可以单独处理某个字段
db.CN.update({&apos;_id&apos;: 2},{$set:{&apos;title&apos;:&apos;hahahahaha&apos;}})
</code></pre><h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>remove , deleteOne , deleteMany</p>
<h4 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h4><pre><code>db.CN.remove(
  &lt;query&gt;,
  {
    justOne: &lt;boolean&gt;,
    writeConcern: &lt;document&gt;
  }
)
</code></pre><ul>
<li>query :（可选）删除的文档的条件</li>
<li>justOne : （可选）如果设为 true 或 1，则只删除一个文档，默认false</li>
<li>writeConcern :（可选）抛出异常的级别</li>
</ul>
<p>例子：</p>
<pre><code>db.CN.remove{
  {&apos;_id&apos;: 2},
  {
    justOne: true // 删除全部匹配的
  }
}
// 清空数据库
db.CN.remove({})
</code></pre><h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><ul>
<li>(&gt;) 大于 - $gt</li>
<li>(&lt;) 小于 - $lt</li>
<li>(&gt;=) 大于等于 - $gte</li>
<li>(&lt;= ) 小于等于 - $lte</li>
<li>(!=) 不等于 - $ne</li>
<li>(or) 或者 - $or</li>
<li>$in （在相同的字段，使用$in而不是$or）</li>
</ul>
<p>例子：</p>
<pre><code>// 显示: &apos;likes&apos;大于100的数据
db.col.find({&quot;likes&quot; : {$gt : 100}})
// 显示：&apos;likes&apos;大于100且小于200的数据
db.col.find({likes : {$lt :200, $gt : 100}})
</code></pre><h4 id="AND"><a href="#AND" class="headerlink" title="AND"></a>AND</h4><pre><code>// status === &quot;A&quot; &amp;&amp; age &gt; 30
db.CN.find( { status: &quot;A&quot;, age: { $lt: 30 } } )
</code></pre><h4 id="OR"><a href="#OR" class="headerlink" title="OR"></a>OR</h4><pre><code>// status === &quot;A&quot; || age &gt; 30
db.CN.find(
   {
     $or: [ { status: &quot;A&quot; }, { age: { $lt: 30 } } ]
   }
)
</code></pre><h4 id="AND-和-OR-混用"><a href="#AND-和-OR-混用" class="headerlink" title="AND 和 OR 混用"></a>AND 和 OR 混用</h4><pre><code>// status === &quot;A&quot; &amp;&amp; ( age &gt; 30 || type === 1 )
db.CN.find(
  {
    status: &quot;A&quot;,
    $or: [ { age: { $lt: 30 } }, { type: 1 } ]
  }
)
</code></pre><h4 id="type"><a href="#type" class="headerlink" title="$type"></a>$type</h4><p>每种数据类型的$type值</p>
<ul>
<li>Double  1  </li>
<li>String  2  </li>
<li>Object  3  </li>
<li>Array 4  </li>
<li>Binary data 5  </li>
<li>Undefined 6 已废弃。</li>
<li>Object id 7  </li>
<li>Boolean 8  </li>
<li>Date  9  </li>
<li>Null  10   </li>
<li>Regular Expression  11   </li>
<li>JavaScript  13   </li>
<li>Symbol  14   </li>
<li>JavaScript (with scope) 15   </li>
<li>32-bit integer  16   </li>
<li>Timestamp 17   </li>
<li>64-bit integer  18   </li>
<li>Min key 255 Query with -1.</li>
<li><p>Max key 127</p>
<p>  // 获取到’title’是字符串的数据<br>  db.CN.find({“title” : {$type : 2}})</p>
</li>
</ul>
<h3 id="set"><a href="#set" class="headerlink" title="$set"></a>$set</h3><pre><code>// 只修改某个字段
db.CN.update(id: 1, { $set: { name: &apos;123&apos; } })
</code></pre><h3 id="其他的一些方法"><a href="#其他的一些方法" class="headerlink" title="其他的一些方法"></a>其他的一些方法</h3><h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>限制读取数据的数量</p>
<pre><code>// 限制读取的数量为2
db.CN.find({},{&quot;title&quot;:1,_id:0}).limit(2)
</code></pre><h4 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h4><p>从第几个开始</p>
<pre><code>// 获取匹配到的数据，从第10行开始显示
db.CN.find().skip(10)

//混合使用，获取匹配到的数据，从10开始获取，获取100个
db.CN.find().skip(10).limit(100)
</code></pre><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><p>排序，1和-1，1为升序，-1为降序。</p>
<p>sort() =&gt; skip() =&gt; limit()</p>
<pre><code>// 以key值，升序排序
db.CN.find().sort({KEY:1})
</code></pre><h4 id="aggregate-gt-聚合"><a href="#aggregate-gt-聚合" class="headerlink" title="aggregate() =&gt; 聚合"></a>aggregate() =&gt; 聚合</h4><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="mongodb组成"><a href="#mongodb组成" class="headerlink" title="mongodb组成"></a>mongodb组成</h3><ol>
<li>database：数据库</li>
<li>collection：集合（表）</li>
<li>document：文档（row）</li>
<li>field：域（字段）</li>
<li>index：索引</li>
<li>primary key（主键，自动将_id设置为主键）</li>
</ol>
<p>BSON是一种类json的一种二进制形式的存储格式,简称Binary JSON</p>
<p>mongodb可以说是json的格式</p>
<h4 id="document"><a href="#document" class="headerlink" title="document"></a>document</h4><p>文档是一组<strong>键值（Key-value）</strong>对</p>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><ol>
<li>文档的键/值对是<strong>有序</strong>的</li>
<li>不仅可以是在双引号里面的字符串，还可以是其他几种数据类型</li>
<li>区分类型和大小写</li>
<li>不能有重复的键</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符</li>
</ol>
<h5 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h5><ol>
<li>键不能含有\0（空字符）</li>
<li>.和$有特别意义</li>
<li>以’_’开头的键是保留（不推荐）</li>
</ol>
<h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h4><h5 id="命名规范-1"><a href="#命名规范-1" class="headerlink" title="命名规范"></a>命名规范</h5><ol>
<li>不能说空字符串</li>
<li>不能含有\0（空字符）</li>
<li>不能以’system.’开头</li>
</ol>
<h5 id="capped-collections"><a href="#capped-collections" class="headerlink" title="capped collections"></a>capped collections</h5><p>固定大小的collection，性能更好</p>
<p>collection的数据存储空间值要提前分配</p>
<p><code>db.createCollection(&quot;mycoll&quot;, {capped:true, size:100000})</code></p>
<h4 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h4><p>数据库的信息存储在集合中</p>
<p><code>dbname.system.*</code></p>
<ul>
<li>.namespaces：列出所有名字空间</li>
<li>.indexes：列出所有索引</li>
<li>.profile：包含数据库概要信息</li>
<li>.CN：列出所有可访问数据库的用户</li>
<li>.sources：包含复制对端的服务器信息和状态</li>
</ul>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul>
<li>String，在MongoDB中，UTF-8编码的字符串才是合法的</li>
<li>Integer，整型，32位或64位</li>
<li>Boolean</li>
<li>Double，双精度浮点值</li>
<li>Min/Max keys，将一个值与BSON元素的最低值和最高值相对比</li>
<li>Arrays，数组或列表</li>
<li>Timestamp，时间戳</li>
<li>Object：内嵌文档</li>
<li>Null</li>
<li>Symbol，符号</li>
<li>Date：日期时间</li>
<li>Object ID，对象ID，用于创建文档的ID</li>
<li>Binary Data：二进制数据</li>
<li>Code：代码类型，用于在文档存储javascript代码</li>
<li>Regular expression：正则</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><ul>
<li>本地：<code>mongodb://localhost</code></li>
<li>有用户名和密码：<code>mongodb://user:pwd@localhost</code></li>
<li>数据库：<code>mongodb://fred:foobar@localhost/db</code></li>
<li>连接服务器1和服务器2：<code>mongodb://example1.com:27017,example2.com:27017</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/02/recording/hexo操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/02/recording/hexo操作/" itemprop="url">hexo操作</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-02T11:42:13+08:00">
                2017-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/记录/" itemprop="url" rel="index">
                    <span itemprop="name">记录</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/02/recording/hexo操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/02/recording/hexo操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/02/recording/hexo操作/" class="leancloud_visitors" data-flag-title="hexo操作">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>记录平常常用的hexo操作</p>
</blockquote>
<h1 id="hexo安装"><a href="#hexo安装" class="headerlink" title="hexo安装"></a>hexo安装</h1><pre><code>// 在全局安装hexo
npm i hexo -g
</code></pre><h1 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h1><ol>
<li>先在博客根目录里，<code>git clone</code>你要安装的主题</li>
<li>在博客的<code>_config.yml</code>配置文件中，修改<code>themes</code></li>
<li>完成</li>
</ol>
<p>每个主题，作者都会有配置介绍的，根据配置来调整就好了。</p>
<h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><ol>
<li>hexo n ‘name’ – 新建文章</li>
<li>hexo clean – 清除缓存（根据网上文章，每次上传前，都要先清除缓存）</li>
<li>hexo s – 开发模式</li>
<li>hexo g – 生成文件</li>
<li>hexo d – 上传文件</li>
</ol>
<h1 id="设置分类"><a href="#设置分类" class="headerlink" title="设置分类"></a>设置分类</h1><p>每篇文章中的tag下面加上<code>categories:</code>，就会自动生成你想要的分类了，还可以在根目录文件中，<code>scaffolds/post.md</code>加上<code>categories:</code>，这样就会自动添加分类了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/logo.gif"
               alt="Rni-L" />
          <p class="site-author-name" itemprop="name">Rni-L</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yiiouo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rni-L</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-yiiouo-github-io.disqus.com/count.js" async></script>
    

    

  











  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("vD9lHLi5QOmwQClMGaq1YWsW-gzGzoHsz", "O9GPrsAJNYIaQClj8yNKSrFH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
