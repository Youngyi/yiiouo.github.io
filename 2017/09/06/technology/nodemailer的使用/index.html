<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="nodemailer nodejs," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="前段时间有个很普通的项目需要发邮件的功能，而且是刚开始学nodejs，所以只是搜索了下用什么好的库能实现，就找到了nodemailer了。这篇文章主要是记录一下使用的过程和经验。  如何使用这里就先上配置 nodejs: v6.9.4 npm: 3.10.10 nodemailer: ^4.1.0 const params = {   host: &amp;apos;smtp.163.com&amp;apos;">
<meta name="keywords" content="nodemailer nodejs">
<meta property="og:type" content="article">
<meta property="og:title" content="nodemailer的使用">
<meta property="og:url" content="http://yoursite.com/2017/09/06/technology/nodemailer的使用/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="前段时间有个很普通的项目需要发邮件的功能，而且是刚开始学nodejs，所以只是搜索了下用什么好的库能实现，就找到了nodemailer了。这篇文章主要是记录一下使用的过程和经验。  如何使用这里就先上配置 nodejs: v6.9.4 npm: 3.10.10 nodemailer: ^4.1.0 const params = {   host: &amp;apos;smtp.163.com&amp;apos;">
<meta property="og:image" content="http://yoursite.com/images/nodemailer1.jpg">
<meta property="og:image" content="http://yoursite.com/images/nodemailer2.jpg">
<meta property="og:image" content="http://yoursite.com/images/nodemailer3.jpg">
<meta property="og:updated_time" content="2017-09-06T10:08:26.424Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nodemailer的使用">
<meta name="twitter:description" content="前段时间有个很普通的项目需要发邮件的功能，而且是刚开始学nodejs，所以只是搜索了下用什么好的库能实现，就找到了nodemailer了。这篇文章主要是记录一下使用的过程和经验。  如何使用这里就先上配置 nodejs: v6.9.4 npm: 3.10.10 nodemailer: ^4.1.0 const params = {   host: &amp;apos;smtp.163.com&amp;apos;">
<meta name="twitter:image" content="http://yoursite.com/images/nodemailer1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/09/06/technology/nodemailer的使用/"/>





  <title>nodemailer的使用 | Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-102257497-2', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f11380fcb075224d78c5110a02679bd1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/06/technology/nodemailer的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rni-L">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">nodemailer的使用</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-06T15:21:08+08:00">
                2017-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/06/technology/nodemailer的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/06/technology/nodemailer的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/09/06/technology/nodemailer的使用/" class="leancloud_visitors" data-flag-title="nodemailer的使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>前段时间有个很普通的项目需要发邮件的功能，而且是刚开始学nodejs，所以只是搜索了下用什么好的库能实现，就找到了nodemailer了。这篇文章主要是记录一下使用的过程和经验。</p>
</blockquote>
<h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><p>这里就先上配置</p>
<p>nodejs: v6.9.4</p>
<p>npm: 3.10.10</p>
<p>nodemailer: ^4.1.0</p>
<pre><code>const params = {
  host: &apos;smtp.163.com&apos;, // 设置服务
  port: 465, // 端口
  sercure: true, // 是否使用TLS，true，端口为465，否则其他或者568
  auth: {
    user: config.user, // 邮箱和密码
    pass: config.emailPwd
  }
}

// 邮件信息
const mailOptions = {
  from: config.user, // 发送邮箱
  to: config.emailTo, // 接受邮箱
  subject: config.title, // 标题
  html: config.html // 内容
}

// 发送邮件
const transporter = nodemailer.createTransport(params)
transporter.sendMail(mailOptions, (error, info) =&gt; {
  if (error) {
    return console.log(error);
  }
  console.log(&apos;Message %s sent: %s&apos;, info.messageId, info.response);
  // success
  // ...
})
</code></pre><p>按照这个格式，发送成功是没什么问题的。不过在<strong>密码</strong>这里要注意，不是邮箱的登录密码。</p>
<h2 id="163和qq获取授权码"><a href="#163和qq获取授权码" class="headerlink" title="163和qq获取授权码"></a>163和qq获取授权码</h2><p>163邮箱的话，要开启POP3/SMTP服务，在设置 –&gt; POP3/SMTP/IMAP页面，设置。开通后会有个授权码的，配置里的密码，就是用这个授权码</p>
<p>qq邮箱的话，同样也要开启这个服务，设置 –&gt; 账户 –&gt; POP3服务，点击开启，就会有个授权码，如果忘了记录，在开启服务下面有个“生成授权码”的，可以获取到的。</p>
<p>这样qq和163就能开启了</p>
<h2 id="Gmail"><a href="#Gmail" class="headerlink" title="Gmail"></a>Gmail</h2><p>如果是Gmail的话，这个就有点麻烦了，在nodemailer官网也有说到：</p>
<p>Gmail either works well or it does not work at all. It is probably easier to switch to an alternative service instead of fixing issues with Gmail. If Gmail does not work for you then don’t use it.</p>
<p>我这里用自己的谷歌邮箱试了下，在上面的配置修改一下</p>
<pre><code>const params = {
  service: &apos;Gmail&apos;, // 注意，host修改为service
  port: 465, // 端口
  sercure: true, // 是否使用TLS，true，端口为465，否则其他或者568
  auth: {
    user: config.user, // 邮箱和密码
    pass: config.emailPwd
  }
}
</code></pre><p>如果这样不行的话，<a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="external">打开这个链接，开启谷歌允许不够安全应用</a></p>
<p>如果还不行的话，就要配置谷歌的XOAuth2了</p>
<h3 id="配置XOAuth2"><a href="#配置XOAuth2" class="headerlink" title="配置XOAuth2"></a>配置XOAuth2</h3><p>就算使用了这种方法，也未必可能成功</p>
<p><a href="http://masashi-k.blogspot.hk/2013/06/sending-mail-with-gmail-using-xoauth2.html" target="_blank" rel="external">这是我在网上找到的配置XOAuth2的教程</a></p>
<p><a href="https://console.developers.google.com/apis/credentials" target="_blank" rel="external">在这里创建一个凭据</a>，选择OAuth客户端ID，应用类型选择“网页应用”，然后填写名称，重定向URI要记得填写，我填写的是这个”<a href="https://developers.google.com/oauthplayground" target="_blank" rel="external">https://developers.google.com/oauthplayground</a>“</p>
<p><img src="/images/nodemailer1.jpg" alt=""></p>
<p>然后记录下id和密钥</p>
<p><a href="https://developers.google.com/oauthplayground/" target="_blank" rel="external">进入此页面，进行配置</a></p>
<p><img src="/images/nodemailer2.jpg" alt=""></p>
<p>填写之前的id和密钥</p>
<p>然后就是step1，选择api</p>
<p><img src="/images/nodemailer3.jpg" alt=""></p>
<p>到step2，点击’Exchange authorization code for tokens’按钮，生成token，这样就完成了。</p>
<p>回到nodejs，重写下配置</p>
<pre><code>const params = {
  service: &apos;Gmail&apos;,
  auth: {
    type: &apos;OAuth2&apos;,
    user: config.user,
    clientId: config.clientId,
    clientSecret: config.clientSecret,
    refreshToken: config.refreshToken,
    accessToken: config.accessToken
  }
}
</code></pre><p>我这里测试是成功的（本地服务器），如果还不成功的话，这个你只能在搜搜有什么解决方法了。</p>
<p><a href="https://nodemailer.com/smtp/oauth2/" target="_blank" rel="external">这里是官方的OAuth2配置</a></p>
<h1 id="nodemailer其他功能"><a href="#nodemailer其他功能" class="headerlink" title="nodemailer其他功能"></a>nodemailer其他功能</h1><p>这里列出我自己用过的功能，<code>nodemailer</code>看官方介绍，貌似是很多功能的</p>
<h2 id="发送多个用户："><a href="#发送多个用户：" class="headerlink" title="发送多个用户："></a>发送多个用户：</h2><pre><code>// 在配置发送信息的时候
const mailOptions = {
  from: config.user, // 发送邮箱
  to: config.emailTo + &apos;, &apos; + config.emailTo2 // 用&apos;, &apos;分隔
}
</code></pre><h2 id="发送html内容"><a href="#发送html内容" class="headerlink" title="发送html内容"></a>发送html内容</h2><pre><code>const mailOptions = {
  ....
  html: config.html // 这里可以是html字符串
}
</code></pre><h2 id="发送附件"><a href="#发送附件" class="headerlink" title="发送附件"></a>发送附件</h2><p>可以同时发送多个</p>
<pre><code>const mailOptions = {
  ...
  attachments: [{
    filename: &apos;test.txt&apos;,
    content: &apos;hello world!&apos;
  },{
    filename: &apos;test.txt&apos;,
    content: &apos;hello world!&apos;,
    contentType: &apos;text/plain&apos;
  }]
}
</code></pre><p>官方给出的配置</p>
<ul>
<li>filename - filename to be reported as the name of the attached file. Use of unicode is allowed.</li>
<li>content - String, Buffer or a Stream contents for the attachment</li>
<li>path - path to the file if you want to stream the file instead of including it (better for larger attachments)</li>
<li>href – an URL to the file (data uris are allowed as well)</li>
<li>contentType - optional content type for the attachment, if not set will be derived from the filename property</li>
<li>contentDisposition - optional content disposition type for the attachment, defaults to ‘attachment’</li>
<li>cid - optional content id for using inline images in HTML message source</li>
<li>encoding - If set and content is string, then encodes the content to a Buffer using the specified encoding. Example values: ‘base64’, ‘hex’, ‘binary’ etc. Useful if you want to use binary attachments in a JSON formatted email object.</li>
<li>headers - custom headers for the attachment node. Same usage as with message headers</li>
<li>raw - is an optional special value that overrides entire contents of current mime node including mime headers. Useful if you want to prepare node contents yourself</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>刚使用<code>nodemailer</code>踩了不少坑，弄了我一天，<code>Gmail</code>不怎么稳定，后面主管就叫换成<code>qq</code>了，据说<code>qq</code>企业邮箱发送邮件的次数比较多。这篇文章就是记录下使用<code>nodemailer</code>的一些经验。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/nodemailer-nodejs/" rel="tag"># nodemailer nodejs</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/03/recording/你不知道的JavasScript笔记/" rel="next" title="你不知道的JavasScript笔记">
                <i class="fa fa-chevron-left"></i> 你不知道的JavasScript笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/11/recording/vue-baidu-map的使用/" rel="prev" title="vue-baidu-map的使用">
                vue-baidu-map的使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/logo.gif"
               alt="Rni-L" />
          <p class="site-author-name" itemprop="name">Rni-L</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yiiouo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#如何使用"><span class="nav-number">1.</span> <span class="nav-text">如何使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#163和qq获取授权码"><span class="nav-number">1.1.</span> <span class="nav-text">163和qq获取授权码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gmail"><span class="nav-number">1.2.</span> <span class="nav-text">Gmail</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置XOAuth2"><span class="nav-number">1.2.1.</span> <span class="nav-text">配置XOAuth2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nodemailer其他功能"><span class="nav-number">2.</span> <span class="nav-text">nodemailer其他功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#发送多个用户："><span class="nav-number">2.1.</span> <span class="nav-text">发送多个用户：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发送html内容"><span class="nav-number">2.2.</span> <span class="nav-text">发送html内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发送附件"><span class="nav-number">2.3.</span> <span class="nav-text">发送附件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rni-L</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-yiiouo-github-io.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2017/09/06/technology/nodemailer的使用/';
          this.page.identifier = '2017/09/06/technology/nodemailer的使用/';
          this.page.title = 'nodemailer的使用';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://https-yiiouo-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  











  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("vD9lHLi5QOmwQClMGaq1YWsW-gzGzoHsz", "O9GPrsAJNYIaQClj8yNKSrFH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
