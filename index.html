<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="who&apos;s your daddy?">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="who&apos;s your daddy?">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog">
<meta name="twitter:description" content="who&apos;s your daddy?">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8132e0d5ed8e5dd365f3f4508e378aac";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/17/linux指令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/17/linux指令/" itemprop="url">
                  linux指令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T21:28:17+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/17/linux指令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/17/linux指令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>最要记录我平时用的linux指令，方便查找</p>
</blockquote>
<ul>
<li>ls : 显示当前目录的文件</li>
<li><p>cd : 进入某个文件</p>
</li>
<li><p>service nginx / mysql / vsftpd restart : 重启服务</p>
</li>
<li>cat …. : 查看某个文件</li>
<li>vi …. : 编辑某个文件</li>
<li>:q …. : 编辑文件时，不保存退出</li>
<li>:w …. : ….保存</li>
<li>:qw … : ….保存并退出</li>
<li>rm -rf … : 删除文件夹</li>
<li>rm -f … : 删除文件</li>
<li><p>unzip : 解压zip压缩包（在服务器解压，更快）</p>
</li>
<li><p>chmod -R 777 xxx : 给权限</p>
</li>
<li>netstat -tunpl : 查看端口</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/移动端布局方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/11/移动端布局方式/" itemprop="url">
                  移动端布局方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-11T15:06:16+08:00">
                2017-07-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/11/移动端布局方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/11/移动端布局方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>这篇文章，主要是总结一下，我在移动端布局用过的方法。有三种，一种是响应式布局，利用@meida判断各个size；第二种是REM；最后是设置viewport中的width。</p>
</blockquote>
<h2 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h2><p>这种感觉是最好理解了，利用@media进行断点，在每个断点中编写css。</p>
<pre><code>@media (max-width:768px){
    //css
}
</code></pre><p>上面这段代码，在浏览器的宽度低于768时有效。同理，如果把<code>max</code>换成<code>min</code>，就会变成高于768时有效。可以设置宽度，也可以设置高度，也可以同时设置多个值。</p>
<p>在<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Media_queries" target="_blank" rel="external">MDN,@media</a>上，发现很多值都可以做判断的。宽，高，宽高比，颜色（这个是指定输出设备每个像素单位的比特值），是否横屏或竖屏，还有很多，可以去MDN看看。</p>
<h3 id="媒体类型"><a href="#媒体类型" class="headerlink" title="媒体类型"></a>媒体类型</h3><p>@meida还可以根据媒体类型进行断点。</p>
<ul>
<li>all，所有设备</li>
<li>print，打印</li>
<li>screen，彩色的电脑屏幕</li>
<li>speech，不知道什么来的。</li>
</ul>
<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><pre><code>@media (max-width:1000px){
    div{background:blue;}
}
@media (min-width:1000px) and (max-width:1150px){
    div{background: yellow;}
}
@media only screen and (max-width:1150px){
    div{border:solid 1px;}
}
@media not print and (max-width:1150px){
    div{border-radius:50%;}
}
</code></pre><ul>
<li>and，就是‘和’的意思，前后两个条件都达到时</li>
<li>only，唯一</li>
<li>not，除了这个之外</li>
</ul>
<p>上面4个@media，分别的效果是：</p>
<ol>
<li>当浏览器宽度低于1000px时</li>
<li>当浏览器宽度大于1000px 和 小于1150px时</li>
<li>当在屏幕上显示 和 宽度小于1150px时</li>
<li>除了在打印上显示外 和 宽度小于1150px时</li>
</ol>
<h3 id="按需‘加载’css"><a href="#按需‘加载’css" class="headerlink" title="按需‘加载’css"></a>按需‘加载’css</h3><p>@media还可以用在link标签上。</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;css/1.css&quot; media=&apos;(max-width:500px)&apos;&gt;
</code></pre><p>当浏览器宽度低于500px时，<code>1.css</code>的样式才会有效果。但这不代表大于500px时，就没加载了<code>1.css</code>。使用了<code>@media</code>属性后，只会让你当条件符合了，才让对应的css文件有效果。而且用这种方式有一个好处，就是不用在css里写<code>@media</code>。</p>
<p><img src="./images/rem_4.jpg" alt="效果图"></p>
<h3 id="平常响应式网站的开发"><a href="#平常响应式网站的开发" class="headerlink" title="平常响应式网站的开发"></a>平常响应式网站的开发</h3><p>平时响应式网站的开发，我都会先对比PC和MOBILE的设计稿，看看有什么区别，然后才进行编写css。通常都是使用<code>flex</code>。宽度尽量用百分比，间距、高度、字体大小使用 <code>em</code>，就可以很方便的进行大小的控制。</p>
<h2 id="REM"><a href="#REM" class="headerlink" title="REM"></a>REM</h2><p>REM这个单位，会根据html的<code>font-size</code>大小进行转换。</p>
<pre><code>html{font-size:100px;}
p{padding-top:.5rem;}
</code></pre><p>.5rem = 50px / 100</p>
<p>转换后p的<code>padding-top</code>就是<code>50px</code>了。只要我们进行适当的计算，当前屏幕的宽度，html的<code>font-size</code>是多少px就OK了。</p>
<h3 id="如何计算当前html的font-size值"><a href="#如何计算当前html的font-size值" class="headerlink" title="如何计算当前html的font-size值"></a>如何计算当前html的font-size值</h3><p>比如，我们拿到的设计稿是750px，那就设置成当屏幕宽度是750的时候，html的<code>font-size</code>就是<code>100px</code>（当然这个100px你可以随意设置的，我设置成100px只是方便我计算），然后就根据当前屏幕的宽度 / 750 * 100，就得到了当前屏幕宽度的<code>font-size</code>值。</p>
<pre><code>//当前屏幕宽度 / 750 = 当前屏幕宽度的font-size / 100
//代码如下
(function (doc, win) {
    var docEl = doc.documentElement,
    resizeEvt = &apos;orientationchange&apos; in window ? &apos;orientationchange&apos; : &apos;resize&apos;,
    recalc = function () {
      var clientWidth = docEl.clientWidth;
      if (!clientWidth) return;
      docEl.style.fontSize = 100 * (clientWidth / 750) + &apos;px&apos;;
    };

    if (!doc.addEventListener) return;
       win.addEventListener(resizeEvt, recalc, false);
       doc.addEventListener(&apos;DOMContentLoaded&apos;, recalc, false);
})(document, window);
</code></pre><p>上面这段代码，是直接根据屏幕宽度进行计算font-size的。而<a href="https://github.com/amfe/article/issues/17" target="_blank" rel="external">淘宝移动端REM方案</a>，还根据你的dpr去计算，而且会进行整体的缩放。淘宝的这种方案，比上面的代码会好很多。</p>
<p><img src="/images/rem_2.png" alt="第一种方案"></p>
<p><img src="/images/rem_1.jpg" alt="第二种方案"></p>
<p>大家注意边框的大小。第二张图的边框是比第一张图的小的，两个都是<code>border:solid 1px</code>。其他的边距都是一样。淘宝的方案，解决了另一个问题：边框1px的问题。</p>
<p>大家可以打开以下链接，看看具体的效果：</p>
<p><a href="http://www.rni-l.com/mobile/index2.html" target="_blank" rel="external">第一种方案</a></p>
<p><a href="http://www.rni-l.com/mobile/index.html" target="_blank" rel="external">第二种方案</a></p>
<h3 id="淘宝移动端REM"><a href="#淘宝移动端REM" class="headerlink" title="淘宝移动端REM"></a>淘宝移动端REM</h3><p>这个很简单，只需要加载js就好了</p>
<pre><code>&lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/{{version}}/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
</code></pre><p>然后在css中，将px转为rem就好了。我是用scss的，所以写个函数就好了。</p>
<pre><code>@function s($px) {
    @return ($px / 75) * 1rem;
}
p{
    font-size:s(40);padding-left: s(52);
}
</code></pre><p>比如p的<code>font-size</code>在750的设计稿是<code>40px</code>，然后<code>s(40)</code>就OK了。</p>
<h2 id="设置viewport中的width"><a href="#设置viewport中的width" class="headerlink" title="设置viewport中的width"></a>设置viewport中的width</h2><p>这种方案，就是定死viewport中的width大小。</p>
<p>比如设计稿是750的，然后就在代码上写：</p>
<pre><code>&lt;met name=&apos;viewport&apos; content=&apos;width=750&apos; /&gt;
</code></pre><p>我们用同样的页面，看看效果是怎么样</p>
<p><img src="/images/rem_3.jpg" alt="第一种方案"></p>
<p>链接：<a href="http://www.rni-l.com/mobile/index3.html" target="_blank" rel="external">第三种方案</a></p>
<p>效果和第二种是一样的，在手机上看也是。</p>
<pre><code>.top{
    display: flex;align-items:center;padding:50px 0 113.5px;justify-content:space-between;width:100%;
    p{
        font-size:40px;padding-left:52px;
    }
    img{
        width:71.5px;height: 71.5px;display: block;margin-right: 63.5px;
    }
}
</code></pre><p>而代码是直接使用px的，定死的。</p>
<p>感觉从效果上来看，是很完美的，但是为什么不是这种方法最流行？</p>
<pre><code>@media screen and (max-width:360px){
    .box{color:red;}
}

@media screen and (max-width:520px){
    .box{color:black;}
}

@media screen and (max-width:750px){
    .box{color:yellow;}
}
</code></pre><p>我在iphone7，小米5s，谷歌浏览器模拟的iphone6plus上，字体颜色都是<strong>黄色</strong>的。所以<code>@media</code>媒体查询是无法使用的，因为已经将宽度定死了。而REM方案却可以使用媒体查询的。因为移动端有很多奇怪的大小，而且在不同的浏览器或者微信上，高度都是不同的，所以可能会造成间距有很大的问题。</p>
<pre><code>window.screen.width
</code></pre><p>用js，可以获取当前设备的宽度。</p>
<h2 id="对比三种方式"><a href="#对比三种方式" class="headerlink" title="对比三种方式"></a>对比三种方式</h2><h3 id="响应式的优缺点"><a href="#响应式的优缺点" class="headerlink" title="响应式的优缺点"></a>响应式的优缺点</h3><p>优点：兼容性好，@media在ie9以上是支持的，PC和MOBILE是同一套代码的，不用分开。</p>
<p>缺点：要写得css相对另外两个多很多，而且各个断点都要做好。css样式会稍微大点，更麻烦。</p>
<h3 id="REM优缺点"><a href="#REM优缺点" class="headerlink" title="REM优缺点"></a>REM优缺点</h3><p>优点：能维持能整体的布局效果，移动端兼容性好，不用写多个css代码，而且还可以利用@media进行优化。</p>
<p>缺点：开头要引入一段js代码，单位都要改成rem(font-size可以用px)，计算rem比较麻烦(可以引用预处理器，但是增加了编译过程，相对麻烦了点)。pc和mobile要分开。</p>
<h3 id="设置viewport中的width-1"><a href="#设置viewport中的width-1" class="headerlink" title="设置viewport中的width"></a>设置viewport中的width</h3><p>优点：和REM相同，而且不用写rem，直接使用px，更加快捷。</p>
<p>缺点：效果可能没rem的好，图片可能会相对模糊，而且无法使用@media进行断点，不同size的手机上显示，高度间距可能会相差很大。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还是看项目需求，再决定使用哪种方案，如果就手机站的话，我使用REM比较多。如果对距离比较精确的话，大量css3动画的，就使用第三种。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/08/ajax的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/08/ajax的使用/" itemprop="url">
                  ajax的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-08T23:25:03+08:00">
                2017-07-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/08/ajax的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/08/ajax的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>主要复习下ajax的使用，包括原生、jquery和jsonp的使用。</p>
</blockquote>
<h2 id="原生的ajax"><a href="#原生的ajax" class="headerlink" title="原生的ajax"></a>原生的ajax</h2><p>ajax是一种无刷新获取数据的技术，通过xhr对象实现，现在有个新的标准是<code>fetch api</code>，这里就不讨论它了。</p>
<pre><code>var xhr = new XMLHttpRequest();
xhr.open(&quot;GET&quot;,&quot;http://localhost/ajax/test.php&quot;,true);
xhr.send();
xhr.onreadystatechange = function(){
    //这样就能获取到返回的数据了
    console.log(xhr.response)
}
</code></pre><p>上面例子，很简单就获取到了，没有做其他条件的判断。下面我们一步步地看，每个状态发生了事情。</p>
<pre><code>var xhr = new XMLHttpRequest();
xhr.open(&quot;GET&quot;,&quot;http://localhost/ajax/test.php&quot;,true);
</code></pre><p>这里实例化一个xhr对象，并打开了一个链接，使用了<code>GET</code>方法，<code>true</code>是异步请求。</p>
<h3 id="open方法"><a href="#open方法" class="headerlink" title="open方法"></a>open方法</h3><p>open方法总共有5个参数的：</p>
<ol>
<li>method，请求方法，可以有：GET,POST,PUT,DELETE等。</li>
<li>url，请求的链接。</li>
<li>async，是否异步请求，默认为true。</li>
<li>用户名，可选参数，为授权使用。默认参数为空string。</li>
<li>密码，可选参数，为授权使用。默认参数为空string。</li>
</ol>
<p>第四、五个，没用过，不怎么清楚。第三个，通常都是用异步请求的，可能特殊情况才用到同步吧。主要是第一个和第二个参数。</p>
<h3 id="send方法"><a href="#send方法" class="headerlink" title="send方法"></a>send方法</h3><pre><code>xhr.send();
</code></pre><p>这里就是发送请求。如果使用的是<code>GET</code>方法，就不需要传参数，如果是<code>POST</code>或是其他方法。</p>
<p>如果是要发送内容的话，就像下面这样：</p>
<pre><code>xhr.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
xhr.send(&quot;a=1&amp;b=cba&amp;c=&quot;+JSON.stringify({test:&apos;hahaha&apos;}));
</code></pre><p>将你要传的参数变成字符串，通过<code>&amp;</code>进行分隔多个参数。要传<code>{c:123}</code>对象的话，就要变成JSON字符串。</p>
<p>我们还看到，在还送请求前，使用了<code>setRequestHeader()</code>这个方法。从字面上理解，就是设置请求头部，它接受两个参数，头部的名称和值。</p>
<p>我们把请求的内容格式，设置成<code>aaplicaiont/x-www-form-urlencoded</code>。</p>
<h3 id="发送请求的状态"><a href="#发送请求的状态" class="headerlink" title="发送请求的状态"></a>发送请求的状态</h3><p><code>onreadystatechange</code>，会一直把信息发送给客户端，会不断地执行回调函数，不能直接在回调函数做事情，不然就会不断地进行操作。</p>
<p>xhr会有一个状态的属性，判断当前是什么状态。</p>
<pre><code>xhr.readyState
</code></pre><p><img src="/images/xhr状态.jpg" alt="xhr状态"></p>
<p>从上图可以看到，当状态为3时，就获取到数据。</p>
<p>每个状态的意义：</p>
<ol>
<li>0（还没开始）</li>
<li>1（读取中）</li>
<li>2（已读取）</li>
<li>3（数据交换中）</li>
<li>4（一切完成）</li>
</ol>
<p>虽然在3已经获取到数据了，可能是我们这里数据比较小。所以，最安全，已经在状态为4时，才执行后续操作。</p>
<h3 id="http状态码"><a href="#http状态码" class="headerlink" title="http状态码"></a>http状态码</h3><pre><code>xhr.status
</code></pre><p>当我们<code>xhr.readyState === 4</code>时，我们就可以验证http状态码。</p>
<p>常见的http状态码：200,404,302,304,500。。。。。</p>
<pre><code>xhr.onreadystatechange = function(x){
    if(xhr.readyState === 4){
        //传送完毕
        var _status = xhr.status;
        if((_status &gt;= 200 &amp;&amp; _status &lt; 300) || _status === 304){
            //成功
            success(xhr.response);
        }else{
            //有问题
            console.log(_status)
        }
    }
}
</code></pre><p>就是这么简单（还没兼容旧版本的ie），获取到<code>xhr.response</code>就可以进行一系列的操作</p>
<p>完整代码：</p>
<pre><code>var xhr = new XMLHttpRequest();
xhr.open(&quot;POST&quot;,&quot;http://localhost/ajax/test.php&quot;,true);
xhr.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
xhr.send(&quot;c=&quot;+JSON.stringify({test:&apos;hahaha&apos;}));
xhr.onreadystatechange = function(x){
    if(xhr.readyState === 4){
        //传送完毕
        var _status = xhr.status;
        if((_status &gt;= 200 &amp;&amp; _status &lt; 300) || _status === 304){
            //成功
            console.log(xhr)
        }else{
            //有问题
            console.log(_status)
        }
    }
}
//php代码：
&lt;?php
    echo $_POST[&apos;c&apos;];
?&gt;
</code></pre><p>在ie8运行都是可以的，ie7、6就不讨论了。</p>
<h2 id="jquery的ajax"><a href="#jquery的ajax" class="headerlink" title="jquery的ajax"></a>jquery的ajax</h2><pre><code>$.ajax({
    url:&apos;http://localhost/ajax/test.php&apos;,
    type:&apos;POST&apos;,
    data:{c:123},
    dataType:&apos;json&apos;,
    success:function(res){
        console.log(res)
    },
    error:function(error){
        console.log(error)        
    }
})
</code></pre><p>jq的ajax很简单，帮我们封装好了，兼容性又好。</p>
<ul>
<li>url:请求的地址</li>
<li>type:请求的方法</li>
<li>data:请求所带的数据</li>
<li>dataType:预期服务器返回的数据类型</li>
<li>success:成功后的回调函数</li>
<li>error:失败后的回调函数</li>
</ul>
<p>详细大家可以看下jquery的文档。</p>
<h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><p>因为浏览器的同源策略，所以无法请求跨域的数据。</p>
<p>当前协议不同(http和https)，端口不同，域名不同，都是跨域的。</p>
<p>在后端，可以设置跨域头，这样ajax就可以跨域获取数据，但是这个ie9以下都不支持。</p>
<h3 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h3><p>jsonp就是通过script标签，获取数据。</p>
<pre><code>function addScriptTag(src){
    var script = document.createElement(&apos;script&apos;);
    script.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);
    script.src = src;
    document.body.appendChild(script);
}
addScriptTag(&quot;http://localhost/ajax/test.php?c=1&amp;callback=result&quot;);
function result(data) {
    console.log(data)
}
//php代码
echo $_GET[&apos;callback&apos;].&quot;(&quot;.$_GET[&apos;c&apos;].&quot;)&quot;;
</code></pre><p>原理很简单，通过创建script标签，请求相应的url。在url，我们携带了要传的参数。所以这样只能使用<code>GET</code>。</p>
<p>而在PHP代码中，我们可以把那段代码意思转变一下：<code>result(data)</code>。其实就是当script标签加载完后， 就会执行你传的回调函数。</p>
<h4 id="jquery中使用jsonp"><a href="#jquery中使用jsonp" class="headerlink" title="jquery中使用jsonp"></a>jquery中使用jsonp</h4><pre><code>$.getJSON(&quot;http://localhost/ajax/test.php?a=1&amp;c=1&amp;callback=?&quot;,function(data){
    console.log(data);
});
//or
$.ajax({
    url:&quot;http://localhost/ajax/test.php?a=1&amp;c=1&amp;callback=?&quot;,   
    dataType:&quot;jsonp&quot;,
    success:function(data){
        console.log(data);
    }
});
</code></pre><p>使用jquery的jsonp的话，更简单，不用特地写一个函数做回调，jquery会自动帮你完成。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/14/php-workman-gateway/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/14/php-workman-gateway/" itemprop="url">
                  'php-gateway的使用';
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-14T09:14:55+08:00">
                2017-06-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/14/php-workman-gateway/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/14/php-workman-gateway/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="php-gateway"><a href="#php-gateway" class="headerlink" title="php-gateway"></a>php-gateway</h1><blockquote>
<p>在<a href="https://github.com/yiiouo/js-vod-system" target="_blank" rel="external">自己的项目</a>中，用到了php的gateway，gateway是基于workerman再次开发的一个网络框架，看下<a href="http://doc2.workerman.net" target="_blank" rel="external">手册</a>和DEMO，就可以基本的使用了。</p>
</blockquote>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><h3 id="下载，增加php环境变量"><a href="#下载，增加php环境变量" class="headerlink" title="下载，增加php环境变量"></a>下载，增加php环境变量</h3><p>我电脑是Windows，所以下载的是Windos版本。在官网下载文件后（<a href="http://www.workerman.net/download" target="_blank" rel="external">下载地址</a>），随意找个地方解压就好了。然后在系统-&gt;高级系统设置-&gt;环境变量-&gt;用户变量中的path，编辑-&gt;添加你的php所在的目录地址。</p>
<p>我用的是wamp，所以php的地址是：D:\wamp\bin\php\php5.3.10  </p>
<p>最后打开解压后的文件，会有个start_for_win.bat的批处理，点击打开它就OK了。这样就会打开服务，可以使用。</p>
<h3 id="使用Websocket"><a href="#使用Websocket" class="headerlink" title="使用Websocket"></a>使用Websocket</h3><p>Gateway文件夹，大部分文件我们不用理的，只要关注Applications/YourApp/文件中的Events.php 和start_gateway.php这两个文件就行了。</p>
<p>Events.php是处理业务代码。start_gateway.php是处理使用什么协议，端口是多少。</p>
<p>因为我用的是Websocket，在start_gateway.php中，将协议改成webscoket,并写上ip地址。</p>
<pre><code>$gateway = new Gateway(&quot;websocket://127.0.0.1:8282&quot;);
</code></pre><p>这里ip地址如果是<code>127.0.0.1</code>，只能让本机使用，<code>本机ip地址</code>，能让内网中的ip使用。</p>
<h2 id="开发功能"><a href="#开发功能" class="headerlink" title="开发功能"></a>开发功能</h2><h3 id="Events-php"><a href="#Events-php" class="headerlink" title="Events.php"></a>Events.php</h3><p>在Events.php中，大概结构是这样的：</p>
<pre><code>class Events{
   public static function onConnect($client_id){}
   public static function onMessage($client_id,$message){}
   public static function onClose($client_id){}
}
</code></pre><ul>
<li>onConnect：当链接连接成功后的回调函数</li>
<li>onMessage：当客户端发送信息后的回调函数</li>
<li>onClose：当链接关闭后的回调函数</li>
</ul>
<p>主要用到的是<code>onMessage</code>，客户端通过websocket发送信息，就会触发此函数，我们就可以通过gateway给的一些方法，把要处理的数据，发送给全部用户或者特定的用户。</p>
<p>每个函数的参数功能，都如同它的名字一样。<code>$client_id</code>是发送数据的用户id，这个id由Gateway生成的，不用我们是理。<code>$message</code>是用户发送的数据，发送的数据格式，最好就是字符串，所以前端后端，要把数据发送出去，都要先将它转成字符串。</p>
<pre><code>public static function onConnect($client_id){
    //当客户端连接成功后，就发送一条当前用户的id给所有连接此连接的客户端
    Gateway::sendToAll(&quot;$client_id&quot;);
}
</code></pre><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>前端的代码也是很简单</p>
<pre><code>&lt;div&gt;send data&lt;/div&gt;
&lt;script&gt;
    //这里的地址要和start_gateway.php中注册的Gateway地址一样
    var ws = new WebSocket(&apos;ws:127.0.0.1:8282&apos;)
    ws.addEventListener(&apos;open&apos;, function(e){
        console.log(e)
    }, false)
    ws.addEventListener(&apos;message&apos;, function(e){
        console.log(e)
    }, false)
    document.querySelector(&apos;div&apos;).addEventListener(&apos;click&apos;,function(){
        ws.send(&apos;我发了信息，111&apos;)
    },false)
&lt;/script&gt;
</code></pre><p>页面打开后，连接成功，就会收到了一条信息。如果我们将再新建一个页面，同样的代码，两个页面都会收到信息。</p>
<p>同样，我们主要写的代码，也是放在<code>message</code>的回调函数里。</p>
<h3 id="Gateway常用的方法"><a href="#Gateway常用的方法" class="headerlink" title="Gateway常用的方法"></a>Gateway常用的方法</h3><p>这里列出我用到的，详细大家可以看手册。</p>
<ul>
<li>sendToAll：对所有用户发送数据，<code>Gateway::sendToAll($data)</code></li>
<li>sendToClient：对某个用户发送数据，<code>Gateway::sendToClient($client_id,$data)</code></li>
<li>joinGroup：添加用户到某个组，<code>Gateway::joinGroup($group_name,$client_id)</code></li>
<li>sendToGroup：对某个组内的所有用户发送数据,<code>Gateway::sendToGroup($group_name,$data)</code></li>
</ul>
<p>我现在暂时用到这4个，其他还没研究。这里说下Gateway的group。一个组可以含有多个用户，一个用户可以加入多个组，而且用户断线后，会自动从组里删除。这个是非常好用的，指定某个群组的人，发送数据。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/php-verificationCode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/23/php-verificationCode/" itemprop="url">
                  '前后端分离，php验证码处理';
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T17:24:55+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/23/php-verificationCode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/23/php-verificationCode/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前后端分离，php验证码处理"><a href="#前后端分离，php验证码处理" class="headerlink" title="前后端分离，php验证码处理"></a>前后端分离，php验证码处理</h1><blockquote>
<p>在<a href="https://github.com/yiiouo/todo-vue" target="_blank" rel="external">自己的项目</a>，登录注册要用到验证码功能，而这个项目是接后端分离的。因为我是一边学php一边写接口，所以写得不怎么好，继续努力吧。</p>
</blockquote>
<h2 id="使用GD生成验证码"><a href="#使用GD生成验证码" class="headerlink" title="使用GD生成验证码"></a>使用GD生成验证码</h2><p>这个我google了下，看了下代码，很简单就能实现了。</p>
<pre><code>$string = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;;
$str = &quot;&quot;;

for($i=0;$i&lt;6;$i++){
  //随机获取验证码中的数字
  $pos = rand(0,35);
  $str .= $string{$pos};
}

$img_handle = Imagecreate(80, 20);  //图片大小80X20
$back_color = ImageColorAllocate($img_handle, 255, 255, 255); //背景颜色（白色）
$txt_color = ImageColorAllocate($img_handle, 0,0, 0);  //文本颜色（黑色）

//加入干扰线
for($i=0;$i&lt;3;$i++)
{
  $line = ImageColorAllocate($img_handle,rand(0,255),rand(0,255),rand(0,255));
  Imageline($img_handle, rand(0,15), rand(0,15), rand(100,150),rand(10,50), $line);
}
//加入干扰象素
for($i=0;$i&lt;200;$i++) 
{
  $randcolor = ImageColorallocate($img_handle,rand(0,255),rand(0,255),rand(0,255));
  Imagesetpixel($img_handle, rand()%100 , rand()%50 , $randcolor);
}

Imagefill($img_handle, 0, 0, $back_color);             //填充图片背景色
ImageString($img_handle, 28, 10, 0, $str, $txt_color);//水平填充一行字符串
header(&quot;Content-type: image/jpg&quot;); //生成验证码图片    
/*
  比如这个接口链接是http://localhost:80/api/code.php，直接在img中的src给予链接，就会显示出验证码了。
 */
Imagepng($img_handle);//显示图片
</code></pre><p>因为这是前后端分离的，都是用token进行验证登录状态的，没有用到session（至于为什么，我还没去了解），所以要给一个标识id，知道用户发送的验证码对应的是后台中的哪一个。</p>
<h2 id="将图片转成base64，发送给前端"><a href="#将图片转成base64，发送给前端" class="headerlink" title="将图片转成base64，发送给前端"></a>将图片转成base64，发送给前端</h2><p>上面GD生成的验证码，如果前端用ajax去获取的话，会一堆乱码，前端要用到<code>FileReader</code>对象的<code>readAsDataURL</code>方法，将它转成图片。但是这样就获取不了获取到的验证码的标识id了。</p>
<p>所以我想将GD库生成的验证码图片，转成base64，这样就可以组合成个数组，发给前端了。</p>
<p>谷歌了下，找到了方法：</p>
<pre><code>ob_start (); 
  //$img_handle，就是gd生成的图片
  imagejpeg ($img_handle);
  $image_data = ob_get_contents (); 

ob_end_clean (); 
//生成base64图片
$image_data_base64 = &apos;data:image/base64;base64&apos;.base64_encode ($image_data);
</code></pre><p>这样就能生成了base64的图片，是字符串来的，所以最后再组装下数据结构，就可以发送给前端了：</p>
<pre><code>//生成此验证码图片的id, uniqid()方法生成验证码的标识id
echo json_encode(array(
    &apos;pic&apos;=&gt;$image_data_base64,
    &apos;id&apos; =&gt; uniqid(),
    &apos;status&apos; =&gt; 0
))
</code></pre><h2 id="验证码答案和标识id存放在哪里？"><a href="#验证码答案和标识id存放在哪里？" class="headerlink" title="验证码答案和标识id存放在哪里？"></a>验证码答案和标识id存放在哪里？</h2><p>这个问题困扰了我，可以存在数据库，txt文件，cookie，缓存。。。还有其他我就不知道了。缓存这个好像是最好的，后面再研究下。然后如果是读写数据库和txt文件的话，感觉会浪费性能，所以先用了cookie去存储，后面再去了解缓存是怎么操作的。<br>    //id是验证码的标识，pwd是验证码的答案<br>    setcookie(“code”, json_encode(array(‘id’=&gt;$id , ‘pwd’=&gt;$pwd)), time()+3600);</p>
<p>要判断的时候获取下cookie再去判断就好了。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>多尝试点不会的技术吧…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/30/canvas-colorPicker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/30/canvas-colorPicker/" itemprop="url">
                  canvas-colorPicker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-30T10:16:59+08:00">
                2017-03-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/30/canvas-colorPicker/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/30/canvas-colorPicker/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用canvas制作的移动端color-picker"><a href="#使用canvas制作的移动端color-picker" class="headerlink" title="使用canvas制作的移动端color picker"></a>使用canvas制作的移动端color picker</h1><blockquote>
<p>我在另一个<a href="https://github.com/yiiouo/canvas-Image-processing" target="_blank" rel="external">demo</a>中，需要用到color picker，但是找不到我需要的移动端color picker，很多都是pc的，然后发现input[type=’color’]这个东西存在，发现安卓没问题，ios却不支持，但是我看安卓那个color picker貌似很简单就能实现，刚好另一个demo也是用canvas实现的，所以就打算自己写一个。</p>
</blockquote>
<p><img src="/images/color.png" alt="color picker"></p>
<p>效果大概就是这样。外层选择颜色，内层就是混合的。</p>
<h2 id="怎么做？"><a href="#怎么做？" class="headerlink" title="怎么做？"></a>怎么做？</h2><p>这里有两部分，一个是外环，一个是正方形，两个形状内都有两个点，这两个点表示当前选择的颜色。外环的选择的颜色，决定正方形显示的颜色，正方形内的点，决定最终输出的颜色。</p>
<p>所以我先制作外环和正方形的颜色，然后给画布事件获取鼠标位置。再使用canvas的getImageData，我们只需要<code>ctx.getImageData(x,y,1,1)</code>就可以获取到rgba颜色了。</p>
<h2 id="制作外环"><a href="#制作外环" class="headerlink" title="制作外环"></a>制作外环</h2><p>制作这个外环，一开始想到是用渐变来处理的，但无论线性还是径向，都好像搞不出来，然后我google了下，使用线和hsl就可以搞出来了。我们这里制作的外环，是一个圆形，这里就可以用循环360，根据每次循环的度数，去制作线。而颜色就是<code>hsl(i , 100% , 50%)</code>这样就可以得到颜色。</p>
<h3 id="hsl"><a href="#hsl" class="headerlink" title="hsl"></a>hsl</h3><p>我们看看hsl是怎么组成的。<br>H：Hue(色调)。0(或360)表示红色，120表示绿色，240表示蓝色，也可取其他数值来指定颜色。取值为：0 - 360<br>S：Saturation(饱和度)。取值为：0.0% - 100.0%<br>L：Lightness(亮度)。取值为：0.0% - 100.0%</p>
<p>我们只需改变H(色调)就可以制造出常用的颜色出来。</p>
<h3 id="获取坐标，制作线"><a href="#获取坐标，制作线" class="headerlink" title="获取坐标，制作线"></a>获取坐标，制作线</h3><p>canvas中的mveTo和lineTo，需要x,y坐标，才能制作出一条线，再通过hsl颜色，进行绘制。这里获取x,y坐标，用到了三角函数，<code>Math.sin,Math.cos</code>。要注意的是，它们接受的值是弧度，而不是角度，所以我们要先把角度转成弧度先<code>rad = i * (2 * Math.PI) / 360</code>。</p>
<p><img src="/images/math.png" alt="计算x,y坐标"></p>
<p>看这图，应该能大概知道了x,y坐标的获取，不过这里获取的x,y是相对于圆心的距离，而不是相对于(0,0)这个点，所以我们还要加上半径r，才是最终的x,y坐标。</p>
<pre><code>for (var i = 0; i &lt; 360; i += .1) {
    //获取度数
    var rad = i * (2 * Math.PI) / 360;
  //计算x,y坐标
  x = r + Math.cos(rad) * r;
  y = r + Math.sin(rad) * r;
  //然后连接线
  ctx.strokeStyle = &quot;hsl(&quot; + i + &quot;, 100%, 50%)&quot;;
  ctx.beginPath();
  ctx.moveTo(r,r);
  ctx.lineTo(x,y);
  ctx.stroke();
  ctx.closePath();
}
</code></pre><p>这样就可以制作出渐变色的圆形，但却不是圆环，因为中间是透明，没有颜色的(也不能是白色)。原本我打算再绘制一个白色圆来覆盖中间部分的，但我想要的是透明的效果，这样看起来会好很多。所以继续在上面循环做文章了。</p>
<p>既然终点可以计算，那起点也是同样的道理，只不过加的长度不同而已。</p>
<pre><code>for (var i = 0; i &lt; 360; i += .1) {
    //获取度数
    var rad = i * (2 * Math.PI) / 360，
     angleX = Math.cos(rad),
     angleY = Math.sin(rad),
     lineW = 20;//圆环的厚度

  //然后连接线
  ctx.strokeStyle = &quot;hsl(&quot; + i + &quot;, 100%, 50%)&quot;;
  ctx.beginPath();

  //计算坐标
  ctx.moveTo(r + angleX * (r - lineW),r + angleY * (r - lineW));
  ctx.lineTo(r + angleX * r,r + angleY * r);
  ctx.stroke();
  ctx.closePath();
}
</code></pre><p>这样就可以制作出圆环的效果，而且中间的圆形是透明的。</p>
<h2 id="制作正方形颜色"><a href="#制作正方形颜色" class="headerlink" title="制作正方形颜色"></a>制作正方形颜色</h2><p>这里是用了三种颜色叠加起来的。首先是从外环获取到的颜色，加上从左到右的白色渐变色，加上从下到上的黑色渐变色。每当外环的颜色改变后，要重新生成正方形的颜色。</p>
<h2 id="判断手指移动的坐标"><a href="#判断手指移动的坐标" class="headerlink" title="判断手指移动的坐标"></a>判断手指移动的坐标</h2><p>接着，就要给canvas添加事件了，来判断手指移动的坐标，是否在圆环或者正方形内，然后根据这个坐标去生成颜色。</p>
<p>这里就主要说下，怎么判断移动时，是否在圆环内。</p>
<p>移动时，通过事件对象event，可以获取到x,y坐标</p>
<pre><code>var t = event.touches[0],
  x = t.pageX - oCan_left,
  y = t.pageY - oCan_top;
</code></pre><p>这里获取到x,y坐标还要减去画布到可视区的左，上的距离。因为我们计算的时候，是根据画布的坐标计算的，(0,0)坐标就是画布的左上角。</p>
<p>接着我们来计算，这个x,y坐标到圆心的距离<code>d = Math.sqrt(Math.pow((x - r),2) , Math.pow((y - r),2))</code>。这里用的是知道两点坐标，得到两点之间的距离，公式是这样的<code>d = √(x1 - x2)² + (y1 - y2)²</code></p>
<p><img src="/images/circle.png" alt="坐标图"></p>
<p>如上图，画布宽高其实就是外圆的直径，r1*2。开始点(0,0)在左上角。我们移动的坐标，到圆心的距离d，小于r1且大于r2的话，就是在圆环内了。<br><code>d &gt;= r2 &amp;&amp; d &lt;= r1</code></p>
<h2 id="获取颜色"><a href="#获取颜色" class="headerlink" title="获取颜色"></a>获取颜色</h2><p>这个简单，得到了x,y坐标后就可以直接获取颜色了，直接上代码</p>
<pre><code>var pixel = this.ctx.getImageData(x, y, 1, 1),
    data = pixel.data,
    rgb = &apos;rgb(&apos; + data[0] + &apos;,&apos; + data[1] + &apos;,&apos; + data[2] + &apos;)&apos;;
return rgb
</code></pre><h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p>我已经把代码上传到<a href="https://github.com/yiiouo/canvas-colorPicker" target="_blank" rel="external">github</a>了，大家可以下载使用。<br>只要把colorPicker.js和colorPicker.css导入就好了。按下面代码调用即可:</p>
<pre><code>//html结构
&lt;div class=&apos;colorPickerbox&apos;&gt;
  &lt;canvas id=&apos;colorPicker&apos;&gt;&lt;/canvas&gt;
  &lt;div class=&quot;colorPickerBtnWrap&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

//调用代码
new ColorPicker({
  oBox: document.querySelector(&apos;.colorPickerbox&apos;),//最外层
  oBtnWrap: document.querySelector(&apos;.btnWrap&apos;),//按钮外层
  oCan: document.querySelector(&apos;#colorPicker&apos;),//画布
  width: 200,//画布宽高
  height: 200,
  callback:function(color){//回调函数
    //color就是获取到的颜色
  }
}).init()//初始化
</code></pre><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个color picker我用了一个下午左右的时间，大概完成了。主要是生成颜色区域，判断手指移动所在的区域，这两块花了多点的时间。而且用到了三角函数，还有一些坐标计算啊，数学都已经还给了老师，要多写下这种demo，顺便来复习下数学。<br>可以用canvas来处理的东西太多了，看来是要花更多的时间在canva这部分，因为确实挺有趣的 :)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/20/h5图片上传处理总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/20/h5图片上传处理总结/" itemprop="url">
                  h5图片上传处理总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-20T10:53:23+08:00">
                2017-03-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/20/h5图片上传处理总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/20/h5图片上传处理总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>这篇文章主要是总结，我在做图片上传，图片处理，图片合成，生成图片遇到过的坑。这个项目只在微信上展示，所以移动端的浏览器都没怎么测试，都是在android和ios的微信上进行测试。主要的坑都是来自ios上。</p>
</blockquote>
<h1 id="HTML5图片上传遇到的坑"><a href="#HTML5图片上传遇到的坑" class="headerlink" title="HTML5图片上传遇到的坑"></a>HTML5图片上传遇到的坑</h1><h2 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h2><h3 id="使用input-type-”file”-获取图片"><a href="#使用input-type-”file”-获取图片" class="headerlink" title="使用input[type=”file”]获取图片"></a>使用input[type=”file”]获取图片</h3><p>使用input[type=”file”]进行图片的上传，这个标签就能让用户拍照或者上传相册的图片了。<br><code>&lt;input type=&quot;file&quot;  accept=&quot;image/*&quot; capture=&quot;camera&quot;&gt;</code><br><code>accept=&#39;image/*</code>用来定义上传文件的类型<br><code>capture=&#39;camera&#39;</code>这个会强制打开相机拍摄，但只有一些浏览器会支持，我试了下，安卓的qq浏览器会，但是UC会直接打不开文件上传，而在微信没有什么问题。<br>当用户选择完毕后，我们就要处理返回的数据，而且input[type=’file’]获取的图片是跨域的。</p>
<h3 id="对获取到图片进行处理，展示在img上"><a href="#对获取到图片进行处理，展示在img上" class="headerlink" title="对获取到图片进行处理，展示在img上"></a>对获取到图片进行处理，展示在img上</h3><p>上传后，不能直接用value值扔给img.src上的，要先获取上传图片的数据<code>var file = this.files[0]</code>，再使用<code>URL.createObjectURL(blob)</code>方法来实现的。</p>
<p>URL.createObjectURL() 静态方法会创建一个DOMString，它的 URL 表示参数中的对象，这个新的URL <strong>对象表示着指定的 File 对象或者 Blob 对象。</strong><br>而Blob对象表示一个<strong>不可变的，原始数据的类似文件对象</strong>  反正就是一个存储数据的对象吧。<br>createObjectURL这个方法，是存在window.URL这个对象里的。在网上也有要写兼容的<code>var windowUrl = window.URL || window.webkitURL</code>。最终就是<code>var data = windowUrl.createObjectURL(file)</code>，就成功获取了可以展示的图片数据，然后<code>img.src=data</code>就行了。完整代码：</p>
<pre><code>var oFile = document.getElementById(&apos;file&apos;),
    oShowImg = document.getElementById(&apos;showImg&apos;)
oFile.addEventListener(&apos;change&apos;, function(e){
    //input值发生改变后
    var file = this.files[0]
    var windowUrl = window.URL || window.webkitURL;
    //把上传的图片，赋值到Img
    oShowImg.src = windowUrl.createObjectURL(file)
}, false);
</code></pre><hr>
<h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><p>然后就是图片的处理。项目的需求是，让用户选择滤镜效果，然后再选择一个海报的图片，编辑里面的文字，最后生成一个新的图片。我看到滤镜那部分，只能去找下插件。<a href="https://github.com/arahaya/ImageFilters.js" target="_blank" rel="external">github图片滤镜</a>，我找到的是这个，按照它的用法，很简单，效果又多，然后就继续下一个效果的实现。<br>让用户选择一个海报的图片，然后编辑的里面的文字。我是用input标签先去代替，当用户输入完毕，要生成图片了，我就根据选择的海报图片和编辑的文字进行添加。</p>
<hr>
<h2 id="生成图片到canvas"><a href="#生成图片到canvas" class="headerlink" title="生成图片到canvas"></a>生成图片到canvas</h2><p>根据用户选择的滤镜效果，海报图片，输入的文字，用canvas进行合成，输出一个新的图片。这里用到canvas的toDataURL();</p>
<pre><code>    //先把宽高给了canvas
var oCan = document.getElementById(&apos;canvas&apos;),
    gct = oCan.getContext(&apos;2d&apos;),
    w = document.documentElement.clientWidth,
    h = document.documentElement.clientHeight

oCan.width = w
oCan.height = h

//写了个图片的公共方法
function cacheImg(url , callback ){
        if(!url){
            callback.call()
            return false;
        }
    var img = new Image()

    img.crossOrigin = &quot;Anonymous&quot;;

    img.onload = function() {
        //图片加载完，执行回调
      callback.call(img)
    }
    img.src = url;

    }
</code></pre><p>一开始先给canvas宽高，然后这个<code>cacheImg(url,callback)</code>的函数，设置图片的crossOrigin，当图片load完成后，执行回调。</p>
<h3 id="crossOrigin"><a href="#crossOrigin" class="headerlink" title="crossOrigin"></a>crossOrigin</h3><p>MDN是这样解释crossOrigin:启用CORS的图像在<code>&lt;canvas&gt;</code>元素中可以重复使用而不会被污染。如果图像被污染了，在最后toDataURL中，就会输出不了，我们后面再看看会是怎么样。详情大家可以去MDN看下<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img" target="_blank" rel="external">img标签的crossOrigin属性</a>。<br><strong>一旦加了这个属性的话，如果图片的数据被改变了，在canvas中就会出现不了。</strong></p>
<h3 id="img-onload"><a href="#img-onload" class="headerlink" title="img.onload"></a>img.onload</h3><p>然后就是img.onload了。如果没有在图片onload完，就进行toDataURL()，生成图片，就会出现白屏或黑屏的现象。因为图片还没加载完，就生成图片，就会没有画像。</p>
<h3 id="生成图片到canvas-1"><a href="#生成图片到canvas-1" class="headerlink" title="生成图片到canvas"></a>生成图片到canvas</h3><pre><code>function createImg(){
    cacheImg(oShowImg.src,function(){
        gct.drawImage(this, 
            0,0,w,h
        );
    })
}
</code></pre><p>上传图片后，触发这段代码，图片就会输出到canvas了。在安卓没问题，但是在ios上问题就大了，图片会出现横向。<br><img src="/images/iospic1.jpg" alt="ios拍摄的图片"><br>第一张图片是img上的，然后第二张图片是在canvas上的。canvas的图片就会出现变横向。这样问题就大了，然后只能百度了。看到解决的方法是用exif.js。要在上传图片后那步就开始处理图片。</p>
<pre><code>//这个是处理图片旋转问题
function getImgData(img,dir,next){
    var image=new Image();
    image.onload=function(){
        var degree=0,drawWidth,drawHeight,width,height;
        //原始宽高
        drawWidth=this.naturalWidth;
        drawHeight=this.naturalHeight;
        //以下改变一下图片大小
        var maxSide = Math.max(drawWidth, drawHeight);
        if (maxSide &gt; 1024) {
        var minSide = Math.min(drawWidth, drawHeight);
        minSide = minSide / maxSide * 1024;
        maxSide = 1024;
        if (drawWidth &gt; drawHeight) {
            drawWidth = maxSide;
            drawHeight = minSide;
        } else {
            drawWidth = minSide;
            drawHeight = maxSide;
        }
    }
    //使用canvas修正图片的方向
    var canvas=document.createElement(&apos;canvas&apos;);
    canvas.width=width=drawWidth;
    canvas.height=height=drawHeight;
    var context=canvas.getContext(&apos;2d&apos;);
    //判断图片方向，重置canvas大小，确定旋转角度，iphone默认的是home键在右方的横屏拍摄方式
    switch(dir){
        //iphone横屏拍摄，此时home键在左侧
        case 3:
        degree=180;
        drawWidth=-width;
        drawHeight=-height;
    break;
    //iphone竖屏拍摄，此时home键在下方(正常拿手机的方向)
    case 6:
        canvas.width=height;
        canvas.height=width;
        degree=90;
        drawWidth=width;
        drawHeight=-height;
    break;
    //iphone竖屏拍摄，此时home键在上方
    case 8:
        canvas.width=height;
        canvas.height=width;
        degree=270;
        drawWidth=-width;
        drawHeight=height;
    break;
    }
        //使用canvas旋转校正
        context.rotate(degree*Math.PI/180);
        context.drawImage(this,0,0,drawWidth,drawHeight);
        //返回校正图片
        next(canvas.toDataURL(&quot;image/png&quot;));
    }
    image.src=img;
}

function change(){
    var file = this.files[0];
    var orientation;
    //EXIF js 可以读取图片的元信息 https://github.com/exif-js/exif-js
    EXIF.getData(file,function(){
        //获取图片的拍摄方向的数据
        orientation=EXIF.getTag(this,&apos;Orientation&apos;);
    });
    var reader = new FileReader();
    reader.onload = function(e) {
        //修正图片方向
        getImgData(this.result,orientation,function(data){
        var img = new Image();
        img.onload = function(){
            oShowImg.src = data
            createImg()
        }
        img.src = data;


    });
    }
    reader.readAsDataURL(file);
}
</code></pre><p>change这段代码，使用了new FileReader()，而不是我一开始那个createObjectURL，最后也能生成新的图片。ios测试，OK没问题。这里用的exif.js，可以获取图片的元数据，就比如这个拍摄方向的数据<code>EXIF.getTag(this,&#39;Orientation&#39;);</code>这就获取到了，我用iphone7拍摄试了下，有4个方向:</p>
<ol>
<li>1:横屏，home键在右边</li>
<li>3:横屏，home键在左边</li>
<li>6:竖屏，home键在下边</li>
<li>8:竖屏，home键在上边<br>然后就是使用canvas的修改方向了。</li>
</ol>
<p>加了<code>img.crossOrigin = &quot;Anonymous&quot;</code>后，在ios上，canvas看不了图片，安卓没问题。好。。。真坑。然后不加这个属性的话，好像也没什么问题，那这个属性有什么用呢。。。<br>我们再看看<code>Anonymous</code>是什么作用。MDN是这解释的：<strong>执行一个跨域的请求（比如，有 Origin: HTTP header）。但是没有发送证书（比如，没有cookie，没有X.509证书，没有HTTP基本的授权认证）。如果服务器没有给源站证书（没有设置Access-Control-Allow-Origin: HTTP头），图像会被污染而且它的使用会被限制。</strong></p>
<hr>
<p>没有设置跨域头，图像被污染的话，会被限制使用。crossOrigin就是防止图片被污染，因为被污染的话，就不能使用canvas的toDataURL等一些的方法，会抛出安全错误。但是我在PC运行没报错，手机运行貌似没问题。好吧我要研究下，反正现在就是暂时不需要用它，因为用了它，污染了图片的数据化，会在ios的canvas显示不了，除非你设置了跨域头（我现在测试的时候没设置）。</p>
<hr>
<h2 id="生成一张新的图片"><a href="#生成一张新的图片" class="headerlink" title="生成一张新的图片"></a>生成一张新的图片</h2><p>使用canvas.toDataURL()这方法。这方法第一个参数，来指定生成的图片是什么格式的，’image/png’，或者’image/jpeg’，或者’image/webp’，第二个参数指定图片的质量，0到1，只有png格式不支持。最终<code>canvas.toDataURL(&#39;image/png&#39;)</code>就能生成图片了。<br>使用toDataURL这个方法，会发现可以使用canvas来搞出很多的效果，最终生成一张图片，各种diy，生成新的图片，这感觉是不错。比如对上传的图片进行涂鸦啊，添加文字，滤镜，各种美化。</p>
<h3 id="在本地测试报错"><a href="#在本地测试报错" class="headerlink" title="在本地测试报错"></a>在本地测试报错</h3><pre><code>Uncaught SecurityError: Failed to execute &apos;toDataURL&apos; on &apos;HTMLCanvasElement&apos;: Tainted canvases may not be exported.(anonymous function) @ canvas_image.html:49img.onload @ canvas_image.html:70
</code></pre><p>因为有海报图片，所有是要两张图片合成一张，在本地直接打开，就报错了，而线上却没事。然后加上<code>img.crossOrigin = &quot;Anonymous&quot;</code>就会报出跨域的错误了。在本地打开的图片是跨域的，所以在本地测试的话，要在服务器上打开。</p>
<hr>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总结下这里写的几个坑<br>1.没有在img.onload后才添加到src上，canvas会显示不出来。<br>2.img标签的crossOrigin属性，当图片数据被污染了，要设置了跨域头才能显示出来。<br>3.上传后的图片，在ios上，图片会变旋转，要用exit.js处理。</p>
<p>其实还有的，图片上传后，尺寸的修正，上传的图片大小限制。这篇就大概总结一下，而且看了下exit.js的api，发现可以挖掘的图片数据很多，这个可以深究。<br>这是我第一次写文章，写得不太好，我会继续努力的。这是<a href="https://github.com/yiiouo/canvas-Image-processing" target="_blank" rel="external">demo地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/18/first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiiouo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/first/" itemprop="url">
                  first
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T11:35:23+08:00">
                2017-03-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/18/first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/18/first/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>This is a regular paragraph.</p>
<p>标题：</p>
<h1 id="This-is-an-H1"><a href="#This-is-an-H1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2"><a href="#This-is-an-H2" class="headerlink" title="This is an H2"></a>This is an H2</h2><h6 id="This-is-an-H6"><a href="#This-is-an-H6" class="headerlink" title="This is an H6"></a>This is an H6</h6><p>引言：</p>
<blockquote>
<p>This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,<br>consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.<br>Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</p>
<p>Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse<br>id sem consectetuer libero luctus adipiscing.</p>
</blockquote>
<hr>
<p>代码：<br>Here is an example of AppleScript:</p>
<pre><code>tell application &quot;Foo&quot;
    beep
end tell
</code></pre><p>Use the <code>printf()</code> function.</p>
<p>链接：<br>This is <a href="http://example.com/" title="Title" target="_blank" rel="external">an example</a> inline link.</p>
<p><a href="http://example.net/" target="_blank" rel="external">This link</a> has no title attribute.</p>
<p>强调：<br><em>single asterisks</em></p>
<p><em>single underscores</em></p>
<p><strong>double asterisks</strong></p>
<p><strong>double underscores</strong></p>
<p>图片<br><img src="../images/to/logo.gif" alt="Alt text"></p>
<p><img src="../images/logo.gif" alt="Alt text" title="Optional title"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  

          
          </div>
          


          
<section id="comments">
  <!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="<%= post.layout %>-<%= post.slug %>" data-title="<%= post.title %>" data-url="<%= page.permalink %>"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
  var duoshuoQuery = {short_name:'<%= config.duoshuo_shortname %>'};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = 'https://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
       || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
  <!-- 多说公共JS代码 end -->
</section>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/logo.gif"
               alt="Yiiouo" />
          <p class="site-author-name" itemprop="name">Yiiouo</p>
           
              <p class="site-description motion-element" itemprop="description">who's your daddy?</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yiiouo</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yiiouo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
